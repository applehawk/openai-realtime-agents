Сценарии:

Зарегистрировал Нового Пользователя -> после входа должно предложить пройти интервью

Вошел как пользователь с не пройденным интервью -> после входа должно предложить пройти интервью

Вошел как пользователь с не полностью пройденным интервью (не на все вопросы получен ответ) -> после входа должно предложить допройти интервью

Вошел как пользователь с уже пройденным интервью -> собрали ключевую информацию и сохранили в контекст

Принцип:

В режиме интервью каждый вопрос задается по очереди, в случае бредового ответа или недостаточных деталей вопрос нужно повторить


@Задание.md я хочу чтобы режим интревью работал в соответсвии с тем что я описал в файле. Перед этим нужно разобраться как оно работает сейчас где и как выполняются тулзы и агенты (на клиенте на беке в openai)

## Текущая архитектура системы интервью

### Где выполняются компоненты:

**1. Агенты (OpenAI Realtime API):**
- **Router Agent** - главный агент, работает в OpenAI Realtime API
- **Interview Agent** - специализированный агент для интервью, работает в OpenAI Realtime API
- **Handoff механизм** - автоматическое переключение между агентами через OpenAI SDK

**2. Инструменты (Tools) - выполняются на клиенте:**
- `getCurrentUserInfo` - получение информации о пользователе
- `queryUserPreferences` - проверка статуса интервью и получение предпочтений
- `startInitialInterview` - запуск интервью
- `conductInitialInterview` - проведение интервью (7 вопросов)
- `updateUserPreferences` - обновление предпочтений

**3. Backend API (Next.js сервер):**
- `/api/interview` - проверка статуса интервью, сохранение данных
- `/api/rag` - прокси для работы с RAG сервером
- `/api/session` - создание сессий OpenAI Realtime

**4. Хранилище данных:**
- **RAG Server** - внешний сервис для хранения профилей пользователей
- **Workspace** - `{userId}_user_key_preferences` для каждого пользователя

### Текущий flow при входе:

1. **Подключение сессии:**
   - Router Agent получает управление
   - Вызывает `getCurrentUserInfo` (получает userId)
   - Вызывает `queryUserPreferences(userId, "полный профиль пользователя со всеми разделами")`

2. **Проверка статуса интервью:**
   - Если профиль НЕ найден или содержит "не располагаю" → делегирует Interview Agent
   - Если профиль найден → сохраняет профиль и продолжает работу

3. **Interview Agent (если нужно):**
   - Задает 7 обязательных вопросов по очереди
   - Каждый ответ передается в `conductInitialInterview`
   - Данные сохраняются в RAG workspace
   - После завершения возвращается к Router Agent

### Текущие проблемы:

**1. Нет автоматического предложения интервью:**
- Интервью запускается только вручную через кнопку "Интервью"
- Нет автоматического предложения после регистрации нового пользователя

**2. Нет поддержки частично завершенного интервью:**
- Система работает по принципу "все 7 вопросов или ничего"
- Нет возможности продолжить незавершенное интервью

**3. Нет валидации ответов:**
- Нет проверки качества ответов пользователя
- Нет повторного вопроса при "бредовых" ответах

**4. UI кнопка не интегрирована с автоматическим flow:**
- Кнопка проверяет статус при загрузке, но не предлагает автоматически
- Нет связи между UI состоянием и логикой агентов

### Файлы системы:

**Агенты:**
- `src/app/agentConfigs/severstalAssistantAgent/agents/routerAgent.ts`
- `src/app/agentConfigs/severstalAssistantAgent/agents/interviewAgent.ts`

**Инструменты:**
- `src/app/agentConfigs/severstalAssistantAgent/tools/interviewTools.ts`
- `src/app/agentConfigs/severstalAssistantAgent/tools/rag/userPreferencesTool.ts`

**UI компоненты:**
- `src/app/components/InterviewButton.tsx`
- `src/app/App.tsx` (обработка кнопки интервью)

**Backend API:**
- `src/app/api/interview/route.ts`
- `src/app/api/rag/route.ts`