# –ê–Ω–∞–ª–∏–∑: Dynamic Replanning - –ü–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–∞–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**Date:** 2025-10-25  
**Type:** Architecture Analysis  
**Status:** üîç Analysis Complete

## üéØ –í–æ–ø—Ä–æ—Å

–°—Ç–æ–∏—Ç –ª–∏ –≤ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á –∏ –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞–Ω–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ?

## üìä –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å (Sequential Execution)

```typescript
// taskOrchestrator.ts, —Å—Ç—Ä–æ–∫–∏ 222-231
const subtaskResults: string[] = [];
for (const subtask of task.subtasks) {
  await this.executeTaskRecursively(subtask, taskTree, ...);
  
  if (subtask.status === 'completed' && subtask.result) {
    subtaskResults.push(`${subtask.description}: ${subtask.result}`);
  }
}
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- ‚úÖ **–õ–∏–Ω–µ–π–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**: subtask1 ‚Üí subtask2 ‚Üí subtask3
- ‚úÖ **–ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**: —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ `subtaskResults`
- ‚úÖ **–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ø–ª–∞–Ω –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
- ‚ùå **–ñ–µ—Å—Ç–∫–æ—Å—Ç—å**: –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–ª–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ß—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

1. **–ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–¥–∞—á**
```typescript
// TaskStatus –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç:
type TaskStatus = 
  | 'planned'
  | 'in_progress'
  | 'completed'
  | 'failed'
  | 'blocked'
  // | 'cancelled' ‚ùå
  // | 'skipped' ‚ùå
```

2. **–ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**
```typescript
// –ù–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–∏–ø–∞:
private async replanBasedOnContext(
  task: Task,
  newContext: string,
  breakdownFn: ...
): Promise<void> {
  // Cancel remaining subtasks
  // Generate new plan
  // Execute new subtasks
}
```

3. **–ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –∑–∞–¥–∞—á**
```typescript
// –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π subtask –Ω–µ—Ç:
if (shouldReplanBasedOnNewData(subtaskResults)) {
  await replanRemainingTasks(...);
}
```

## üé¨ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ó–∞–¥–∞—á–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω–æ–π ‚úÖ –ü–û–õ–¨–ó–ê

```typescript
// –ó–∞–ø—Ä–æ—Å: "–ù–∞–π–¥–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ –í–æ—Å—Ç–æ–∫ –∏ –æ—Ç–ø—Ä–∞–≤—å –∏–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è"

Plan (initial):
  ‚îú‚îÄ Subtask 1: "–ù–∞–π—Ç–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ –í–æ—Å—Ç–æ–∫"
  ‚îú‚îÄ Subtask 2: "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è"
  ‚îî‚îÄ Subtask 3: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è"

// –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Subtask 1:
Result: "–ü—Ä–æ–µ–∫—Ç –í–æ—Å—Ç–æ–∫ –∑–∞–∫—Ä—ã—Ç. –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–µ—Ç."

// –° dynamic replanning:
‚Üí Subtask 2 –∏ 3 –û–¢–ú–ï–ù–Ø–Æ–¢–°–Ø (–Ω–µ –Ω—É–∂–Ω—ã)
‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ–º: "–ü—Ä–æ–µ–∫—Ç –í–æ—Å—Ç–æ–∫ –∑–∞–∫—Ä—ã—Ç, –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è"

// –ë–µ–∑ dynamic replanning:
‚Üí Subtask 2 –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è (–±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ)
‚Üí Subtask 3 –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å (–æ—à–∏–±–∫–∞)
‚Üí –õ–∏—à–Ω–∏–µ API calls, –≤—Ä–µ–º—è, —Ç–æ–∫–µ–Ω—ã
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ù–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –º–µ–Ω—è–µ—Ç –ø–æ–¥—Ö–æ–¥ ‚úÖ –ü–û–õ–¨–ó–ê

```typescript
// –ó–∞–ø—Ä–æ—Å: "–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–µ—á—É —Å –∫–æ–º–∞–Ω–¥–æ–π –∑–∞–≤—Ç—Ä–∞ –≤ 15:00"

Plan (initial):
  ‚îú‚îÄ Subtask 1: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤"
  ‚îú‚îÄ Subtask 2: "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü-–∑–∞–ª"
  ‚îî‚îÄ Subtask 3: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è"

// –ü–æ—Å–ª–µ Subtask 1:
Result: "–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –≤ –æ—Ç–ø—É—Å–∫–µ. –¢–æ–ª—å–∫–æ 1 —á–µ–ª–æ–≤–µ–∫ –¥–æ—Å—Ç—É–ø–µ–Ω."

// –° dynamic replanning:
‚Üí –ü–ª–∞–Ω –ú–ï–ù–Ø–ï–¢–°–Ø:
  ‚îú‚îÄ Subtask 2: "–£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—ã"
  ‚îî‚îÄ Subtask 3: "–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –¥–∞—Ç—ã"

// –ë–µ–∑ dynamic replanning:
‚Üí –ë—Ä–æ–Ω–∏—Ä—É–µ—Ç –∑–∞–ª (–≤–ø—É—Å—Ç—É—é)
‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º –ª—é–¥—è–º
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û—à–∏–±–∫–∞ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ ‚úÖ –ü–û–õ–¨–ó–ê

```typescript
// –ó–∞–ø—Ä–æ—Å: "–û—Ç–ø—Ä–∞–≤—å –æ—Ç—á–µ—Ç –ø–æ email, –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è - —á–µ—Ä–µ–∑ Telegram"

Plan (initial):
  ‚îú‚îÄ Subtask 1: "–°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç"
  ‚îú‚îÄ Subtask 2: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ email"
  ‚îî‚îÄ Subtask 3: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É"

// –ü–æ—Å–ª–µ Subtask 2:
Result: "–û—à–∏–±–∫–∞: Email —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

// –° dynamic replanning:
‚Üí –ü–ª–∞–Ω –ú–ï–ù–Ø–ï–¢–°–Ø:
  ‚îî‚îÄ Subtask 4: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç —á–µ—Ä–µ–∑ Telegram" (NEW)

// –ë–µ–∑ dynamic replanning:
‚Üí –ó–∞–¥–∞—á–∞ failed, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–∑–∞–ø—Ä–æ—Å–∏—Ç—å
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü—Ä–æ—Å—Ç–∞—è –ª–∏–Ω–µ–π–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚ùå –ò–ó–ë–´–¢–û–ß–ù–û–°–¢–¨

```typescript
// –ó–∞–ø—Ä–æ—Å: "–ü—Ä–æ—á–∏—Ç–∞–π –ø–∏—Å—å–º–æ –æ—Ç –ê–Ω–Ω—ã –∏ –Ω–∞–∑–Ω–∞—á—å –≤—Å—Ç—Ä–µ—á—É"

Plan:
  ‚îú‚îÄ Subtask 1: "–ü—Ä–æ—á–∏—Ç–∞—Ç—å –ø–∏—Å—å–º–æ –æ—Ç –ê–Ω–Ω—ã"
  ‚îî‚îÄ Subtask 2: "–ù–∞–∑–Ω–∞—á–∏—Ç—å –≤—Å—Ç—Ä–µ—á—É –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è"

// –ü–æ—Å–ª–µ Subtask 1:
Result: "–ê–Ω–Ω–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤—Å—Ç—Ä–µ—á—É –∑–∞–≤—Ç—Ä–∞ –≤ 15:00"

// Dynamic replanning –ù–ï –ù–£–ñ–ï–ù:
‚Üí –ü–ª–∞–Ω –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º
‚Üí Subtask 2 –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–∞–∫ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ
‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ replanning = –ª–∏—à–Ω–∏–µ —Ç–æ–∫–µ–Ω—ã
```

## üìä –ê–Ω–∞–ª–∏–∑: –ü–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã

### ‚úÖ –ê—Ä–≥—É–º–µ–Ω—Ç—ã –ó–ê Dynamic Replanning

#### 1. **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –∫ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏**
```
Plan ‚Üí Execute Subtask 1 ‚Üí NEW DATA ‚Üí Adapt Plan ‚Üí Continue
```
–°–∏—Å—Ç–µ–º–∞ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –º–∏—Ä–µ.

#### 2. **–≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤**
```
–û—Ç–º–µ–Ω–∞ –Ω–µ–Ω—É–∂–Ω—ã—Ö –∑–∞–¥–∞—á:
- –ú–µ–Ω—å—à–µ API calls
- –ú–µ–Ω—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤
- –ë—ã—Å—Ç—Ä–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
```

#### 3. **–õ—É—á—à–∏–π UX**
```
–í–º–µ—Å—Ç–æ: "–ó–∞–¥–∞—á–∞ failed, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞"
‚Üí "–ü–ª–∞–Ω –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–æ–¥–æ–ª–∂–∞—é"
```

#### 4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π**
```
Email –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ Telegram
–£—á–∞—Å—Ç–Ω–∏–∫–∏ –∑–∞–Ω—è—Ç—ã ‚Üí –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –¥—Ä—É–≥–æ–µ –≤—Ä–µ–º—è
```

#### 5. **–ë–æ–ª–µ–µ "—É–º–Ω–∞—è" —Å–∏—Å—Ç–µ–º–∞**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç:
"–û–±–Ω–∞—Ä—É–∂–∏–ª, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –∑–∞–∫—Ä—ã—Ç. –û—Ç–º–µ–Ω–∏–ª –æ—Ç–ø—Ä–∞–≤–∫—É –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π."
```

### ‚ùå –ê—Ä–≥—É–º–µ–Ω—Ç—ã –ü–†–û–¢–ò–í Dynamic Replanning

#### 1. **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** üî¥ –ö–†–ò–¢–ò–ß–ù–û

–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
```typescript
// 1. –ù–æ–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∑–∞–¥–∞—á
type TaskStatus = ... | 'cancelled' | 'skipped';

// 2. –ú–µ—Ö–∞–Ω–∏–∑–º –æ—Ü–µ–Ω–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ replanning
interface ReplanningDecision {
  shouldReplan: boolean;
  reason: string;
  tasksToCancel: string[];
  newSubtasks?: SubtaskDescription[];
}

// 3. –ù–æ–≤—ã–π –∞–≥–µ–Ω—Ç –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ DecisionAgent
replanningAgent: Agent; // –û—Ü–µ–Ω–∏–≤–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å replanning

// 4. –õ–æ–≥–∏–∫–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–¥–∞—á
private cancelTasks(taskIds: string[]): void;

// 5. –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
private async replanRemainingTasks(...): Promise<void>;

// 6. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
// –ß—Ç–æ –µ—Å–ª–∏ –æ—Ç–º–µ–Ω–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ –±—ã–ª–∞ dependency –¥–ª—è –¥—Ä—É–≥–æ–π?
```

**–û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç:** 40-60 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã + —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 2. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ API calls** üí∞ COST

–ù–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π subtask:
```typescript
for (const subtask of task.subtasks) {
  await execute(subtask);
  
  // +1 API call –∫ replanningAgent
  const decision = await replanningAgent.evaluate(
    currentPlan,
    newContext
  );
  
  if (decision.shouldReplan) {
    // +1 API call –∫ DecisionAgent –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–ª–∞–Ω–∞
    await replan();
  }
}
```

**–û—Ü–µ–Ω–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç:**
- Simple task (3 subtasks): +3 replanning checks = +$0.03
- Complex task (10 subtasks): +10 replanning checks = +$0.10
- –ï–∂–µ–¥–Ω–µ–≤–Ω–æ (1000 tasks): +$30-100/–¥–µ–Ω—å

#### 3. **–ù–µ–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚ö†Ô∏è UX ISSUE

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç:
"–ü–ª–∞–Ω–∏—Ä—É—é –≤—ã–ø–æ–ª–Ω–∏—Ç—å 5 –∑–∞–¥–∞—á..."
‚Üí –ü–æ—Å–ª–µ 2-–π –∑–∞–¥–∞—á–∏: "–ü–ª–∞–Ω –∏–∑–º–µ–Ω–µ–Ω, —Ç–µ–ø–µ—Ä—å 3 –∑–∞–¥–∞—á–∏"
‚Üí –ü–æ—Å–ª–µ 3-–π –∑–∞–¥–∞—á–∏: "–ü–ª–∞–Ω —Å–Ω–æ–≤–∞ –∏–∑–º–µ–Ω–µ–Ω, —Ç–µ–ø–µ—Ä—å 4 –∑–∞–¥–∞—á–∏"

–í–æ–ø—Ä–æ—Å: –≠—Ç–æ —Ö–æ—Ä–æ—à–æ –∏–ª–∏ —Å–±–∏–≤–∞–µ—Ç —Å —Ç–æ–ª–∫—É?
```

#### 4. **–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∑–∞–¥–∞—á –Ω–µ —Ç—Ä–µ–±—É—é—Ç replanning** üìä

–ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á:
```
80% –∑–∞–¥–∞—á: –õ–∏–Ω–µ–π–Ω—ã–µ, –ø–ª–∞–Ω –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
15% –∑–∞–¥–∞—á: Minor –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ (–º–æ–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤ Executor)
5% –∑–∞–¥–∞—á: –†–µ–∞–ª—å–Ω–æ –Ω—É–∂–µ–Ω replanning
```

#### 5. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ—â–µ** üí°

–í–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ replanning:

**a) Conditional execution –≤ Executor:**
```typescript
// –í –ø—Ä–æ–º–ø—Ç–µ Executor:
"If subtask result indicates task is no longer needed,
mark remaining subtasks as skipped and return early."
```

**b) Smart aggregation:**
```typescript
// –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö subtasks, Executor:
"Synthesize results, ignoring failed/irrelevant tasks"
```

**c) Error recovery –≤ DecisionAgent:**
```typescript
// DecisionAgent —É–∂–µ –º–æ–∂–µ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å plan:
"If first approach fails, try alternative"
```

#### 6. **–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —á–∞—Å—Ç–∏—á–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç** ‚úÖ

```typescript
// previousResults –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –∫–∞–∂–¥—ã–π subtask:
const executionRequest: TaskExecutionRequest = {
  task,
  conversationContext,
  previousResults: task.subtaskResults, // ‚Üê –ö–æ–Ω—Ç–µ–∫—Å—Ç!
};

// Executor –º–æ–∂–µ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
"Use previousResults to determine if task is still relevant"
```

## üéØ –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Full Dynamic Replanning | Current Architecture + Enhancements |
|----------|------------------------|-------------------------------------|
| **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å** | üî¥ –í—ã—Å–æ–∫–∞—è (40-60 —á–∞—Å–æ–≤) | üü¢ –ù–∏–∑–∫–∞—è (4-6 —á–∞—Å–æ–≤) |
| **–°—Ç–æ–∏–º–æ—Å—Ç—å** | üí∞üí∞üí∞ (+30-100$/–¥–µ–Ω—å) | üí∞ (+5-10$/–¥–µ–Ω—å) |
| **–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º–æ—Å—Ç—å** | ‚ö†Ô∏è –ù–∏–∑–∫–∞—è | ‚úÖ –í—ã—Å–æ–∫–∞—è |
| **–ü–æ–∫—Ä—ã—Ç–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤** | 100% | 85-90% |
| **–†–∏—Å–∫ —Ä–µ–≥—Ä–µ—Å—Å–∏–π** | üî¥ –í—ã—Å–æ–∫–∏–π | üü¢ –ù–∏–∑–∫–∏–π |
| **Time to market** | 3-4 –Ω–µ–¥–µ–ª–∏ | 3-4 –¥–Ω—è |

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥

### –í–º–µ—Å—Ç–æ full dynamic replanning ‚Üí **Smart Execution**

#### 1. **–£—Å–∏–ª–∏—Ç—å Executor –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**

```typescript
// –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç executor.ts:

## Adaptive Execution

When executing leaf task, CHECK previousResults:

**IF task becomes irrelevant based on previous results:**
- Don't execute unnecessary tool calls
- Return: "Task skipped: [reason based on previous results]"
- Example: If "Find participants" returned "Project closed", 
  skip "Send invitations"

**IF task needs adjustment based on context:**
- Adapt execution approach using previousResults
- Example: If email failed, try alternative method mentioned in task
```

**–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:** 2-3 —á–∞—Å–∞  
**–≠—Ñ—Ñ–µ–∫—Ç:** –ü–æ–∫—Ä—ã–≤–∞–µ—Ç 80% —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

#### 2. **–î–æ–±–∞–≤–∏—Ç—å "Early termination" –≤ TaskOrchestrator**

```typescript
// –í executeTaskRecursively –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π subtask:

for (const subtask of task.subtasks) {
  await this.executeTaskRecursively(subtask, ...);
  
  // NEW: Check if remaining tasks are relevant
  if (this.shouldTerminateEarly(subtask, task)) {
    console.log('Early termination: remaining tasks no longer needed');
    // Mark remaining as 'skipped'
    for (const remaining of task.subtasks.slice(i + 1)) {
      remaining.status = 'skipped';
    }
    break;
  }
}

private shouldTerminateEarly(completedSubtask: Task, parentTask: Task): boolean {
  // Simple heuristics:
  // - If subtask.result contains "not found", "closed", "unavailable"
  // - If parentTask has no more dependencies
  return false; // Conservative approach
}
```

**–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:** 4-5 —á–∞—Å–æ–≤  
**–≠—Ñ—Ñ–µ–∫—Ç:** –ü–æ–∫—Ä—ã–≤–∞–µ—Ç –µ—â–µ 10% —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

#### 3. **–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å 'skipped'**

```typescript
// taskTypes.ts
export type TaskStatus =
  | 'planned'
  | 'in_progress'
  | 'completed'
  | 'failed'
  | 'blocked'
  | 'skipped';    // NEW: Task skipped based on context
```

**–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:** 1 —á–∞—Å  

#### 4. **–£–ª—É—á—à–∏—Ç—å aggregation –≤ Executor**

```typescript
// –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç executor.ts Mode 1:

## Intelligent Aggregation

When aggregating subtaskResults:

- **Ignore skipped tasks**: Focus on completed tasks
- **Explain context**: "Tasks 3-5 were skipped because project was closed"
- **Provide complete picture**: Synthesize why plan changed
```

**–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:** 1-2 —á–∞—Å–∞

### –ò—Ç–æ–≥–æ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:

‚úÖ **–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã:** 8-11 —á–∞—Å–æ–≤ (vs 40-60 –¥–ª—è full replanning)  
‚úÖ **–ü–æ–∫—Ä—ã—Ç–∏–µ:** 90% —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (vs 100%)  
‚úÖ **–°—Ç–æ–∏–º–æ—Å—Ç—å:** +5-10$/–¥–µ–Ω—å (vs +30-100$/–¥–µ–Ω—å)  
‚úÖ **–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)  
‚úÖ **Time to market:** 1-2 –Ω–µ–¥–µ–ª–∏

## üîÆ –ë—É–¥—É—â–µ–µ: –ö–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è—Ç—å Full Dynamic Replanning?

–î–æ–±–∞–≤–ª—è–π—Ç–µ –ø–æ–ª–Ω—ã–π replanning –ï–°–õ–ò:

1. ‚úÖ **–î–æ–ª—è –∑–∞–¥–∞—á —Å replanning > 20%** (—Å–µ–π—á–∞—Å ~5%)
2. ‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —è–≤–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç** ("–µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–µ")
3. ‚úÖ **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è** (–º–Ω–æ–≥–æ –∂–∞–ª–æ–±)
4. ‚úÖ **Cost justification:** —ç–∫–æ–Ω–æ–º–∏—è –æ—Ç –æ—Ç–º–µ–Ω—ã –∑–∞–¥–∞—á > —Å—Ç–æ–∏–º–æ—Å—Ç—å replanning checks

## üìã –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (Hybrid Approach)

### Phase 1: Foundation (–î–µ–Ω—å 1-2)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å 'skipped' –≤ TaskStatus
- [ ] –î–æ–±–∞–≤–∏—Ç—å simple heuristics –≤ TaskOrchestrator –¥–ª—è early termination
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É 'skipped' tasks –≤ UI/logging

### Phase 2: Executor Enhancement (–î–µ–Ω—å 3-4)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç Executor: adaptive execution
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç Executor: intelligent aggregation –¥–ª—è skipped tasks
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –≤ –ø—Ä–æ–º–ø—Ç

### Phase 3: Testing (–î–µ–Ω—å 5-7)
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è early termination scenarios
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è skipped tasks aggregation
- [ ] E2E —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏

### Phase 4: Monitoring (–ù–µ–¥–µ–ª—è 2)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏: % skipped tasks
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ early termination decisions
- [ ] –ê–Ω–∞–ª–∏–∑: –Ω—É–∂–µ–Ω –ª–∏ full replanning?

## ‚úÖ –ò—Ç–æ–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –ù–ï –°–¢–û–ò–¢ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å Full Dynamic Replanning –°–ï–ô–ß–ê–°

**–ü—Ä–∏—á–∏–Ω—ã:**
1. üî¥ –°–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ (40-60 —á–∞—Å–æ–≤)
2. üí∞ –°–ª–∏—à–∫–æ–º –¥–æ—Ä–æ–≥–æ (+30-100$/–¥–µ–Ω—å)
3. üìä 90% —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≥–∏–±—Ä–∏–¥–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º
4. ‚ö†Ô∏è –†–∏—Å–∫ over-engineering
5. üéØ –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —á–∞—Å—Ç–∏—á–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–¥–∞–ø—Ç–∞—Ü–∏—é

### ‚úÖ –°–¢–û–ò–¢ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Hybrid Approach (Smart Execution)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
1. ‚úÖ –ë—ã—Å—Ç—Ä–æ (8-11 —á–∞—Å–æ–≤)
2. ‚úÖ –î–µ—à–µ–≤–æ (+5-10$/–¥–µ–Ω—å)
3. ‚úÖ –ü–æ–∫—Ä—ã–≤–∞–µ—Ç 90% —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
4. ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫
5. ‚úÖ –≠–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–π –ø—É—Ç—å –∫ full replanning (–µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è)

---

## üéì –§–∏–ª–æ—Å–æ—Ñ–∏—è

**"Start simple, evolve when needed"**

–ü–æ–ª–Ω–æ–µ dynamic replanning - —ç—Ç–æ **optimization**, –∞ –Ω–µ **necessity**.  
–°–Ω–∞—á–∞–ª–∞ —Ä–µ–∞–ª–∏–∑—É–µ–º –ø—Ä–æ—Å—Ç—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã, –∏–∑–º–µ—Ä—è–µ–º –∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º —Ä–µ—à–∞–µ–º –æ –ø–æ–ª–Ω–æ–º replanning.

**–ü—Ä–∏–Ω—Ü–∏–ø:** 80/20  
- 20% —É—Å–∏–ª–∏–π (–≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥)  
- 80% —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–ø–æ–∫—Ä—ã—Ç–∏–µ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤)

---

**Recommendation:** ‚úÖ Implement Hybrid Approach  
**Timeline:** 1-2 weeks  
**Cost:** Low  
**Risk:** Low  
**Value:** High

