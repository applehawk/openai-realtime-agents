# ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ RAG API - –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞

## üéØ –í–µ—Ä–¥–∏–∫—Ç: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ü–†–ê–í–ò–õ–¨–ù–ê–Ø!

–í—ã–∑–æ–≤ RAG API –Ω–∞–ø—Ä—è–º—É—é –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**.

---

## ‚úÖ –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

### 1. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **RAG_API_BASE_URL** (–ø–æ—Ä—Ç 9621) - REST API
- ‚úÖ –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è RAG_SERVER_URL (–ø–æ—Ä—Ç 8000) - —ç—Ç–æ MCP server –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ü–µ–ª–µ–π
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `callRagApiDirect` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ URL

### 2. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ endpoint'—ã**
```typescript
GET  /workspaces              // –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ workspace'–æ–≤
POST /workspaces              // –°–æ–∑–¥–∞—Ç—å workspace
POST /documents/text          // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
POST /query                   // –ü–æ–∏—Å–∫ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º
```

### 3. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö**

#### –°–æ–∑–¥–∞–Ω–∏–µ workspace:
```json
{ "name": "123_user_key_preferences" }
```

#### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞:
```json
{
  "text": "–ü–†–û–§–ò–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø: 123\n–î–æ–ª–∂–Ω–æ—Å—Ç—å: Developer\n...",
  "file_source": "initial_interview",
  "workspace": "123_user_key_preferences"
}
```

#### –ü–æ–∏—Å–∫:
```json
{
  "query": "–ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 123",
  "mode": "local",
  "top_k": 5,
  "workspace": "123_user_key_preferences"
}
```

### 4. **–û—Ç–ª–∏—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- ‚úÖ **Graceful degradation** - –µ—Å–ª–∏ RAG –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏–Ω—Ç–µ—Ä–≤—å—é –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è
- ‚úÖ **Network error detection** - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–Ω—è—Ç–Ω–æ —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
- ‚úÖ **Timeout** - 30 —Å–µ–∫—É–Ω–¥ –∑–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏—è

### 5. **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ workspace –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
- ‚úÖ –ù–µ —Å–æ–∑–¥–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã
- ‚úÖ –ì–∏–±–∫–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞ API

---

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –ù–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# 1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å RAG API endpoints
./test-rag-api.sh

# –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
# ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å RAG API (–ø–æ—Ä—Ç 9621)
# ‚úÖ GET /workspaces
# ‚úÖ POST /workspaces
# ‚úÖ POST /documents/text
# ‚úÖ POST /query
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```
‚úÖ RAG API is accessible
‚úÖ Test 2: List Workspaces - Success
‚úÖ Test 3: Create Workspace - Success
‚úÖ Test 4: Save Interview Data - Success
‚úÖ Test 5: Query Interview Data - Success
‚úÖ All tests completed!
```

---

## üìä Flow —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å 7
         ‚Üì
conductInitialInterview –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã?
         ‚Üì
    ‚úÖ –î–∞, –≤—Å–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
         ‚Üì
createUserWorkspace("123")
    ‚îú‚îÄ GET http://79.132.139.57:9621/workspaces
    ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: workspace —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?
    ‚îÇ   ‚îú‚îÄ ‚úÖ –î–∞ ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ
    ‚îÇ   ‚îî‚îÄ ‚ùå –ù–µ—Ç ‚Üí POST /workspaces
    ‚îî‚îÄ –í–æ–∑–≤—Ä–∞—Ç (–¥–∞–∂–µ –µ—Å–ª–∏ RAG –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
         ‚Üì
saveInterviewData("123", summary)
    ‚îî‚îÄ POST http://79.132.139.57:9621/documents/text
       Body: { text, file_source, workspace }
       ‚îî‚îÄ –í–æ–∑–≤—Ä–∞—Ç (–¥–∞–∂–µ –µ—Å–ª–∏ RAG –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
         ‚Üì
return { status: 'completed', message: '...' }
```

---

## üîß –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### callRagApiDirect (–±–∞–∑–æ–≤–∞—è)
**–§–∞–π–ª:** `src/app/lib/ragApiClient.ts`

```typescript
export async function callRagApiDirect(endpoint: string, method: string, data?: any) {
  const url = `${RAG_API_BASE_URL}${endpoint}`;  // http://79.132.139.57:9621/endpoint
  
  const response = await fetch(url, {
    method,
    headers: { 'Content-Type': 'application/json' },
    body: data ? JSON.stringify(data) : undefined,
    signal: AbortSignal.timeout(30000),  // 30s timeout
  });
  
  // Error handling + network detection
}
```

### createUserWorkspace
**–§–∞–π–ª:** `src/app/agentConfigs/severstalAssistantAgent/tools/interview/interviewTools.ts`

```typescript
export async function createUserWorkspace(userId: string) {
  const workspaceName = `${userId}_user_key_preferences`;
  
  // 1. GET /workspaces - check if exists
  // 2. If not exists ‚Üí POST /workspaces
  // 3. Graceful degradation if RAG down
}
```

### saveInterviewData
**–§–∞–π–ª:** `src/app/agentConfigs/severstalAssistantAgent/tools/interview/interviewTools.ts`

```typescript
export async function saveInterviewData(userId: string, interviewData: string) {
  const workspaceName = `${userId}_user_key_preferences`;
  
  // POST /documents/text with { text, file_source, workspace }
  // Graceful degradation if RAG down
}
```

---

## üí° –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**
- Timeout –∑–∞—â–∏—Ç–∞ (30 —Å–µ–∫—É–Ω–¥)
- Graceful degradation –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ RAG
- –ò–Ω—Ç–µ—Ä–≤—å—é –Ω–µ –ø–∞–¥–∞–µ—Ç, –∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º

### 2. **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è workspace
- –ù–µ —Å–æ–∑–¥–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏

### 3. **–ì–∏–±–∫–æ—Å—Ç—å**
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞ API:
  - `{ workspaces: [...] }`
  - `[...]`
- –†–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ RAG API

### 4. **Observability**
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –õ–µ–≥–∫–æ –æ—Ç–ª–∞–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

### 5. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏—è `callRagApiDirect`
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (env vars)

---

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ endpoint'—ã REST API
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ Graceful degradation
- ‚úÖ –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ Timeout –∑–∞—â–∏—Ç–∞

### üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- ‚úÖ `RAG_API_REVIEW.md` - –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
- ‚úÖ `RAG_API_CHECK.md` - –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
- ‚úÖ `test-rag-api.sh` - —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

---

## üéØ –ò—Ç–æ–≥

**–í—ã–∑–æ–≤ RAG API –Ω–∞–ø—Ä—è–º—É—é –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ü–†–ê–í–ò–õ–¨–ù–û –∏ –ù–ê–î–ï–ñ–ù–û!**

–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production! üöÄ

---

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 27 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Approved  
**–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:** `./test-rag-api.sh`

