# Hierarchical Task Execution System

**Version:** 1.0
**Date:** 2025-10-22

---

## ะะฑะทะพั

ะกะธััะตะผะฐ ะธะตัะฐััะธัะตัะบะพะณะพ ะฒัะฟะพะปะฝะตะฝะธั ะทะฐะดะฐั ะฟะพะทะฒะพะปัะตั **ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะฐะทะฑะธะฒะฐัั ะพัะตะฝั ัะปะพะถะฝัะต ะทะฐะดะฐัะธ ะฝะฐ ะฟะพะดะทะฐะดะฐัะธ ัะตะบัััะธะฒะฝะพ**, ะฒัะฟะพะปะฝััั ะธั ะฒ ะฟัะฐะฒะธะปัะฝะพะผ ะฟะพััะดะบะต (ั ััััะพะผ ะทะฐะฒะธัะธะผะพััะตะน), ัะพะฑะธัะฐัั ัะตะทัะปััะฐัั ะธะตัะฐััะธัะตัะบะธ ะธ ะณะตะฝะตัะธัะพะฒะฐัั ัะธะฝะฐะปัะฝัะน ะพัััั.

### ะะฐัะตะผ ััะพ ะฝัะถะฝะพ?

**ะัะพะฑะปะตะผะฐ:**
ะะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ะดะฐัั ะพัะตะฝั ัะปะพะถะฝัั ะทะฐะดะฐัั ัะธะฟะฐ: *"ะะฐะนะดะธ ะฒัะตั ััะฐััะฝะธะบะพะฒ ะฟัะพะตะบัะฐ ะะพััะพะบ ะธะท ะฟะตัะตะฟะธัะบะธ, ะฟัะพะฒะตัั ะธั ะบะฐะปะตะฝะดะฐัะธ ะฝะฐ ัะฒะพะฑะพะดะฝะพะต ะฒัะตะผั ะฝะฐ ัะปะตะดัััะตะน ะฝะตะดะตะปะต, ะฝะฐะนะดะธ ะพะฑัะตะต ะฒัะตะผั ะบะพะณะดะฐ ะฒัะต ัะฒะพะฑะพะดะฝั, ัะพะทะดะฐะน ัะพะฑััะธะต ะธ ะพัะฟัะฐะฒั ะฒัะตะผ ะฟัะธะณะปะฐัะตะฝะธั"*.

ะญัะฐ ะทะฐะดะฐัะฐ ัะพะดะตัะถะธั 8+ ัะฐะณะพะฒ, ััะปะพะฒะฝัั ะปะพะณะธะบั, ะผะฝะพะถะตััะฒะตะฝะฝัะต ะธััะพัะฝะธะบะธ ะดะฐะฝะฝัั. ะะธ RealtimeAgent, ะฝะธ ะพะฑััะฝัะน SupervisorAgent ะฝะต ัะฟัะฐะฒัััั ั ะฝะตะน ัััะตะบัะธะฒะฝะพ ะฒ ะพะดะธะฝ ะทะฐะฟัะพั.

**ะะตัะตะฝะธะต:**
1. SupervisorAgent **ะะะะะะะฃะะข** ะทะฐะดะฐัั, ัะฐะทะฑะธะฒะฐั ะตั ะฝะฐ ะฟะพะดะทะฐะดะฐัะธ (plannedSteps)
2. ะกะธััะตะผะฐ **ะะะะฃะะกะะะะ** ัะฐะทะฑะธะฒะฐะตั ะบะฐะถะดัั ะฟะพะดะทะฐะดะฐัั ะฝะฐ ะตัั ะฑะพะปะตะต ะผะตะปะบะธะต (ะตัะปะธ ะฝัะถะฝะพ)
3. ะะฐะถะดะฐั ะปะธััะพะฒะฐั ะทะฐะดะฐัะฐ ะฒัะฟะพะปะฝัะตััั **ะะะะะะะกะะะ** ะบะฐะบ ะพัะดะตะปัะฝะฐั ะทะฐะดะฐัะฐ
4. ะะตะทัะปััะฐัั **ะกะะะะะะฎะขะกะฏ** ะธะตัะฐััะธัะตัะบะธ ัะฝะธะทั ะฒะฒะตัั
5. ะะตะฝะตัะธััะตััั **ะคะะะะะฌะะซะ ะะขะงะะข** ัะพ ะฒัะตะผะธ ะดะตัะฐะปัะผะธ

---

## ะััะธัะตะบัััะฐ

### ะะพะผะฟะพะฝะตะฝัั ัะธััะตะผั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      User Request                            โ
โ           "ะัะตะฝั ัะปะพะถะฝะฐั ะทะฐะดะฐัะฐ ั 8+ ัะฐะณะฐะผะธ"                โ
โโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  RealtimeAgent                               โ
โ  ะะฐัะฟะพะทะฝะฐัั ะพัะตะฝั ัะปะพะถะฝัั ะทะฐะดะฐัั                            โ
โ  โ ะัะทัะฒะฐะตั executeComplexTask tool                         โ
โโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ             TaskOrchestrator (ะพัะบะตัััะฐัะพั)                  โ
โ                                                              โ
โ  1. ะกะพะทะดะฐัั root task                                       โ
โ  2. ะะฐะฟััะบะฐะตั ัะตะบัััะธะฒะฝะพะต ัะฐะทะฑะธะตะฝะธะต                         โ
โ  3. ะััะธัะปัะตั ะฟะพััะดะพะบ ะฒัะฟะพะปะฝะตะฝะธั                            โ
โ  4. ะัะฟะพะปะฝัะตั ะทะฐะดะฐัะธ ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพ                        โ
โ  5. ะกะพะฑะธัะฐะตั ัะตะทัะปััะฐัั                                      โ
โ  6. ะะตะฝะตัะธััะตั ะพัััั                                         โ
โโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
         โโโโโโโโโโโโโดโโโโโโโโโโโโ
         โผ                       โผ
โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ
โ SupervisorAgent  โ    โ SupervisorAgent  โ
โ  (Breakdown)     โ    โ  (Execution)     โ
โ                  โ    โ                  โ
โ ะะฐะทะฑะธะฒะฐะตั ะทะฐะดะฐัั โ    โ ะัะฟะพะปะฝัะตั ะทะฐะดะฐัั โ
โ ะฝะฐ ะฟะพะดะทะฐะดะฐัะธ     โ    โ ั tools (MCP,    โ
โ                  โ    โ RAG, etc.)       โ
โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ
         โ                       โ
         โ                       โ
         โผ                       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   Task Tree Structure                        โ
โ                                                              โ
โ  Root Task (ัะปะพะถะฝะฐั)                                        โ
โ    โโ Subtask 1 (moderate)                                  โ
โ    โ   โโ Subtask 1.1 (simple) โ                           โ
โ    โ   โโ Subtask 1.2 (simple) โ                           โ
โ    โโ Subtask 2 (simple) โ                                  โ
โ    โโ Subtask 3 (complex)                                   โ
โ        โโ Subtask 3.1 (simple) โ                           โ
โ        โโ Subtask 3.2 (simple) โ                           โ
โ        โโ Subtask 3.3 (simple) โ                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     Final Report                             โ
โ  - Summary (ะบัะฐัะบะพะต ัะตะทัะผะต)                                 โ
โ  - Detailed results (ะดะตัะฐะปะธ ะฟะพ ะบะฐะถะดะพะน ะฟะพะดะทะฐะดะฐัะต)            โ
โ  - Hierarchical breakdown (ััััะบัััะฐ ะดะปั UI)                โ
โ  - Statistics (ัะบะพะปัะบะพ ะทะฐะดะฐั ะฒัะฟะพะปะฝะตะฝะพ/ะฟัะพะฒะฐะปะตะฝะพ)           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  RealtimeAgent                               โ
โ  ะะทะฒััะธะฒะฐะตั ัะธะฝะฐะปัะฝัะน ะพัััั ะฟะพะปัะทะพะฒะฐัะตะปั                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ะขะธะฟั ะดะฐะฝะฝัั

### Task (ะทะฐะดะฐัะฐ)

```typescript
interface Task {
  id: string;                    // "task-root", "task-root.0", "task-root.0.1", etc.
  parentId: string | null;       // ID ัะพะดะธัะตะปััะบะพะน ะทะฐะดะฐัะธ
  description: string;           // ะะฟะธัะฐะฝะธะต ะฝะฐ ััััะบะพะผ
  complexity: TaskComplexity;    // "simple" | "moderate" | "complex"
  status: TaskStatus;            // "planned" | "in_progress" | "completed" | "failed" | "blocked"
  level: number;                 // ะฃัะพะฒะตะฝั ะฒะปะพะถะตะฝะฝะพััะธ (0 = root, 1 = subtask, etc.)

  // ะะตะทัะปััะฐัั ะฒัะฟะพะปะฝะตะฝะธั
  result?: string;               // ะะตะทัะปััะฐั (ะฟะพัะปะต ะฒัะฟะพะปะฝะตะฝะธั)
  error?: string;                // ะัะธะฑะบะฐ (ะตัะปะธ ะฟัะพะฒะฐะปะตะฝะพ)
  executionStartTime?: Date;
  executionEndTime?: Date;

  // ะะตัะฐััะธั
  subtasks: Task[];              // ะะพะดะทะฐะดะฐัะธ
  subtaskResults?: string[];     // ะกะพะฑัะฐะฝะฝัะต ัะตะทัะปััะฐัั ะฟะพะดะทะฐะดะฐั

  // ะะพะฝัะตะบัั ะธ ะทะฐะฒะธัะธะผะพััะธ
  context?: Record<string, any>;
  dependencies?: string[];       // IDs ะทะฐะดะฐั, ะบะพัะพััะต ะดะพะปะถะฝั ะทะฐะฒะตััะธัััั ะดะพ ััะพะน
}
```

### TaskTree (ะดะตัะตะฒะพ ะทะฐะดะฐั)

```typescript
interface TaskTree {
  rootTask: Task;                      // ะะพัะฝะตะฒะฐั ะทะฐะดะฐัะฐ
  allTasks: Map<string, Task>;         // ะะปะพัะบะฐั ะบะฐััะฐ ะฒัะตั ะทะฐะดะฐั ะฟะพ ID
  executionOrder: string[];            // ะะพััะดะพะบ ะฒัะฟะพะปะฝะตะฝะธั (ัะพะปัะบะพ ะปะธััะพะฒัะต ะทะฐะดะฐัะธ)
  currentTaskId: string | null;        // ID ัะตะบััะตะน ะฒัะฟะพะปะฝัััะตะนัั ะทะฐะดะฐัะธ

  // ะัะพะณัะตัั
  totalTasks: number;                  // ะัะตะณะพ ะปะธััะพะฒัั ะทะฐะดะฐั
  completedTasks: number;              // ะัะฟะพะปะฝะตะฝะพ
  failedTasks: number;                 // ะัะพะฒะฐะปะตะฝะพ

  // ะะพะฝัะตะบัั
  conversationHistory: string[];       // ะััะพัะธั ะฑะตัะตะดั
}
```

---

## ะะฐะฑะพัะธะน ะฟัะพัะตัั

### 1. ะะฝะธัะธะฐะปะธะทะฐัะธั

```typescript
const orchestrator = new TaskOrchestrator({
  maxNestingLevel: 5,           // ะะฐะบัะธะผัะผ 5 ััะพะฒะฝะตะน ะฒะปะพะถะตะฝะฝะพััะธ
  maxSubtasksPerTask: 10,       // ะะฐะบัะธะผัะผ 10 ะฟะพะดะทะฐะดะฐั ะฝะฐ ะทะฐะดะฐัั
  enableProgressCallbacks: true // ะะบะปััะธัั callbacks ะดะปั UI
});
```

### 2. ะะฐะฟััะบ ะฒัะฟะพะปะฝะตะฝะธั

```typescript
const report = await orchestrator.executeComplexTask(
  taskDescription,              // "ะะฐะนะดะธ ะฒัะตั ััะฐััะฝะธะบะพะฒ ะฟัะพะตะบัะฐ..."
  conversationContext,          // ะะพะปะฝะฐั ะธััะพัะธั ะฑะตัะตะดั
  breakdownFn,                  // ะคัะฝะบัะธั ัะฐะทะฑะธะตะฝะธั (supervisor)
  executeFn,                    // ะคัะฝะบัะธั ะฒัะฟะพะปะฝะตะฝะธั (supervisor/realtime)
  reportFn                      // ะคัะฝะบัะธั ะณะตะฝะตัะฐัะธะธ ะพััััะฐ
);
```

### 3. ะะตะบัััะธะฒะฝะพะต ัะฐะทะฑะธะตะฝะธะต

**ะัะพัะตัั:**

1. **ะัะตะฝะบะฐ ัะปะพะถะฝะพััะธ** - Supervisor ะฐะฝะฐะปะธะทะธััะตั ะทะฐะดะฐัั:
   - ะัะพััะฐั (1 ัะฐะณ, ะฟะพะฝััะฝัะต ะฟะฐัะฐะผะตััั) โ ะฝะต ัะฐะทะฑะธะฒะฐัั
   - ะกัะตะดะฝัั (2-4 ัะฐะณะฐ) โ ะฝะต ัะฐะทะฑะธะฒะฐัั, ะฒัะฟะพะปะฝะธัั ััะฐะทั
   - ะกะปะพะถะฝะฐั (5+ ัะฐะณะพะฒ, ััะปะพะฒะธั, ะทะฐะฒะธัะธะผะพััะธ) โ **ะะะะะะขะฌ**

2. **ะกะพะทะดะฐะฝะธะต ะฟะพะดะทะฐะดะฐั** - Supervisor ะฒะพะทะฒัะฐัะฐะตั 2-10 ะฟะพะดะทะฐะดะฐั:
   ```json
   {
     "shouldBreakdown": true,
     "subtasks": [
       {
         "description": "ะัะฟะพะปะฝั RAG ะทะฐะฟัะพั ะดะปั ะฟะพะธัะบะฐ ััะฐััะฝะธะบะพะฒ ะฟัะพะตะบัะฐ",
         "estimatedComplexity": "simple"
       },
       {
         "description": "ะัะพะฒะตัั ะบะฐะปะตะฝะดะฐัะธ ะฒัะตั ะฝะฐะนะดะตะฝะฝัั ััะฐััะฝะธะบะพะฒ",
         "estimatedComplexity": "moderate",
         "dependencies": [0]  // ะะฐะฒะธัะธั ะพั ะทะฐะดะฐัะธ 0
       }
     ]
   }
   ```

3. **ะะตะบัััะธั** - ะะฐะถะดะฐั ะฟะพะดะทะฐะดะฐัะฐ ะฟัะพะฒะตััะตััั ะฝะฐ ัะปะพะถะฝะพััั:
   - ะัะปะธ ัะปะพะถะฝะฐั โ ัะฐะทะฑะธะฒะฐะตััั ะดะฐะปััะต
   - ะัะปะธ ะฟัะพััะฐั โ ะพััะฐัััั ะปะธััะพะฒะพะน ะทะฐะดะฐัะตะน (ะฑัะดะตั ะฒัะฟะพะปะฝะตะฝะฐ)

4. **ะะณัะฐะฝะธัะตะฝะธั**:
   - ะะฐะบัะธะผัะผ 5 ััะพะฒะฝะตะน ะฒะปะพะถะตะฝะฝะพััะธ
   - ะะฐะบัะธะผัะผ 10 ะฟะพะดะทะฐะดะฐั ะฝะฐ ะทะฐะดะฐัั
   - ะัะตะดะพัะฒัะฐัะฐะตั ะฑะตัะบะพะฝะตัะฝัั ัะตะบัััะธั

### 4. ะัะฟะพะปะฝะตะฝะธะต ะทะฐะดะฐั

**ะะพััะดะพะบ ะฒัะฟะพะปะฝะตะฝะธั:**

```
Root Task (ะฝะต ะฒัะฟะพะปะฝัะตััั ะฝะฐะฟััะผัั)
  โโ Subtask 1 โ [ะัะฟะพะปะฝัะตััั ะฟะตัะฒะพะน]
  โ   โโ 1.1 โ [ะัะฟะพะปะฝัะตััั ะฟะตัะฒะพะน]
  โ   โโ 1.2 โ [ะัะฟะพะปะฝัะตััั ะฒัะพัะพะน]
  โโ Subtask 2 โ [ะัะฟะพะปะฝัะตััั ััะตััะตะน]
  โโ Subtask 3 โ [ะัะฟะพะปะฝัะตััั ัะตัะฒัััะพะน]
      โโ 3.1 โ [ะัะฟะพะปะฝัะตััั ะฟะพัะปะต Subtask 2]
      โโ 3.2 โ [ะัะฟะพะปะฝัะตััั ะฟะพัะปะต 3.1]
```

**Depth-first execution:**
1. ะัะฟะพะปะฝััััั **ัะพะปัะบะพ ะปะธััะพะฒัะต ะทะฐะดะฐัะธ** (ะฑะตะท ะฟะพะดะทะฐะดะฐั)
2. ะะพััะดะพะบ: depth-first (ัะฝะฐัะฐะปะฐ ะฒะณะปัะฑั, ะฟะพัะพะผ ะฒัะธัั)
3. **ะะฐะฒะธัะธะผะพััะธ ััะธััะฒะฐัััั** - ะทะฐะดะฐัะฐ ะฝะต ะฝะฐัะฝัััั, ะฟะพะบะฐ ะทะฐะฒะธัะธะผะพััะธ ะฝะต ะทะฐะฒะตััะตะฝั
4. **ะะพะฝัะตะบัั ะฟะตัะตะดะฐัััั** - ะบะฐะถะดะฐั ะทะฐะดะฐัะฐ ะฟะพะปััะฐะตั ัะตะทัะปััะฐัั ะฟัะตะดัะดััะธั

### 5. ะกะฑะพั ัะตะทัะปััะฐัะพะฒ

**ะะตัะฐััะธัะตัะบะธะน ัะฑะพั:**

```
Subtask 1.1 completed โ result: "ะะฐััะป 6 ััะฐััะฝะธะบะพะฒ"
Subtask 1.2 completed โ result: "ะะทะฒะปัะบ email-ะฐะดัะตัะฐ"
  โ
Subtask 1 collects results:
  result: "ะะฐััะป 6 ััะฐััะฝะธะบะพะฒ. ะะทะฒะปัะบ email-ะฐะดัะตัะฐ."

Subtask 2 completed โ result: "ะัะพะฒะตัะธะป ะบะฐะปะตะฝะดะฐัะธ"
Subtask 3.1 completed โ result: "ะะฐััะป ะพะฑัะตะต ะฒัะตะผั"
Subtask 3.2 completed โ result: "ะกะพะทะดะฐะป ัะพะฑััะธะต"
  โ
Subtask 3 collects results:
  result: "ะะฐััะป ะพะฑัะตะต ะฒัะตะผั. ะกะพะทะดะฐะป ัะพะฑััะธะต."
  โ
Root Task collects all:
  result: "1. ะะฐััะป 6 ััะฐััะฝะธะบะพะฒ. ะะทะฒะปัะบ email-ะฐะดัะตัะฐ.
          2. ะัะพะฒะตัะธะป ะบะฐะปะตะฝะดะฐัะธ.
          3. ะะฐััะป ะพะฑัะตะต ะฒัะตะผั. ะกะพะทะดะฐะป ัะพะฑััะธะต."
```

### 6. ะะตะฝะตัะฐัะธั ะพััััะฐ

**Supervisor ัะพะทะดะฐัั ัะธะฝะฐะปัะฝัะน ะพัััั:**

```json
{
  "summary": "ะฏ ะพัะณะฐะฝะธะทะพะฒะฐะป ะฒัััะตัั ัะพ ะฒัะตะผะธ ััะฐััะฝะธะบะฐะผะธ ะฟัะพะตะบัะฐ 'ะะพััะพะบ'.",
  "detailedResults": "ะะฐััะป ัะตััั ััะฐััะฝะธะบะพะฒ: ะะฒะฐะฝ, ะะฝะฝะฐ, ะััั, ะะฐัะธะฝะฐ, ะกะตัะณะตะน ะธ ะะปัะณะฐ. ะัะพะฒะตัะธะป ะธั ะบะฐะปะตะฝะดะฐัะธ ะฝะฐ ัะปะตะดััััั ะฝะตะดะตะปั ะธ ะฝะฐััะป ะพะฑัะตะต ัะฒะพะฑะพะดะฝะพะต ะฒัะตะผั: ััะตะดะฐ ะฟััะฝะฐะดัะฐัะพะณะพ ัะฝะฒะฐัั ะฒ ัะตัััะฝะฐะดัะฐัั ะฝะพะปั-ะฝะพะปั. ะกะพะทะดะฐะป ัะพะฑััะธะต ะฝะฐ ะดะฒะฐ ัะฐัะฐ ะธ ะพัะฟัะฐะฒะธะป ะฟัะธะณะปะฐัะตะฝะธั ะฒัะตะผ ััะฐััะฝะธะบะฐะผ.",
  "tasksCompleted": 7,
  "tasksFailed": 0,
  "executionTime": 12500,
  "hierarchicalBreakdown": { /* ััััะบัััะฐ ะดะปั UI */ }
}
```

---

## ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะัะธะผะตั 1: ะัะณะฐะฝะธะทะฐัะธั ะฒัััะตัะธ ะบะพะผะฐะฝะดั

**User request:**
> "ะะฐะนะดะธ ะฒัะตั ััะฐััะฝะธะบะพะฒ ะฟัะพะตะบัะฐ ะะพััะพะบ ะธะท ะฟะตัะตะฟะธัะบะธ, ะฟัะพะฒะตัั ะธั ะบะฐะปะตะฝะดะฐัะธ ะฝะฐ ัะปะตะดััััั ะฝะตะดะตะปั, ะฝะฐะนะดะธ ะฒัะตะผั ะบะพะณะดะฐ ะฒัะต ัะฒะพะฑะพะดะฝั, ะธ ะพัะฟัะฐะฒั ะฒัะตะผ ะฟัะธะณะปะฐัะตะฝะธะต ะฝะฐ ะฒัััะตัั"

**Task breakdown:**

```
Root: "ะัะณะฐะฝะธะทะพะฒะฐัั ะฒัััะตัั ะบะพะผะฐะฝะดั ะฟัะพะตะบัะฐ ะะพััะพะบ"
โโ 1. "ะะฐะนัะธ ะฒัะตั ััะฐััะฝะธะบะพะฒ ะฟัะพะตะบัะฐ ะฒ ะฟะตัะตะฟะธัะบะต"
โ   โโ 1.1 "ะัะฟะพะปะฝะธัั RAG ะทะฐะฟัะพั: ััะฐััะฝะธะบะธ ะฟัะพะตะบัะฐ ะะพััะพะบ" โ
โ   โโ 1.2 "ะะทะฒะปะตัั email-ะฐะดัะตัะฐ ะธะท ัะตะทัะปััะฐัะพะฒ" โ
โโ 2. "ะัะพะฒะตัะธัั ะบะฐะปะตะฝะดะฐัะธ ะฒัะตั ััะฐััะฝะธะบะพะฒ ะฝะฐ ัะปะตะด. ะฝะตะดะตะปั"
โ   โโ 2.1 "ะะพะปััะธัั ะดะพัััะฟ ะบ ะบะฐะปะตะฝะดะฐััะผ ััะฐััะฝะธะบะพะฒ" โ
โ   โโ 2.2 "ะะทะฒะปะตัั ะทะฐะฝััะพััั ะบะฐะถะดะพะณะพ ััะฐััะฝะธะบะฐ" โ
โโ 3. "ะะฐะนัะธ ะพะฑัะตะต ัะฒะพะฑะพะดะฝะพะต ะฒัะตะผั"
โ   โโ 3.1 "ะััะธัะปะธัั ะฟะตัะตัะตัะตะฝะธะต ัะฒะพะฑะพะดะฝัั ัะปะพัะพะฒ" โ
โโ 4. "ะกะพะทะดะฐัั ัะพะฑััะธะต ะธ ะพัะฟัะฐะฒะธัั ะฟัะธะณะปะฐัะตะฝะธั"
    โโ 4.1 "ะกะพะทะดะฐัั ัะพะฑััะธะต ะฒ ะบะฐะปะตะฝะดะฐัะต" โ
    โโ 4.2 "ะัะฟัะฐะฒะธัั email-ะฟัะธะณะปะฐัะตะฝะธั ะฒัะตะผ ััะฐััะฝะธะบะฐะผ" โ
```

**Execution order:**
1. Task 1.1 โ RAG query
2. Task 1.2 โ Extract emails
3. Task 2.1 โ Get calendar access
4. Task 2.2 โ Extract availability
5. Task 3.1 โ Find common time
6. Task 4.1 โ Create event
7. Task 4.2 โ Send invitations

**Final report:**
> "ะฏ ะพัะณะฐะฝะธะทะพะฒะฐะป ะฒัััะตัั ัะพ ะฒัะตะผะธ ััะฐััะฝะธะบะฐะผะธ ะฟัะพะตะบัะฐ 'ะะพััะพะบ'. ะะฐััะป ัะตััั ััะฐััะฝะธะบะพะฒ: ะะฒะฐะฝ ะะตััะพะฒ, ะะฝะฝะฐ ะกะผะธัะฝะพะฒะฐ, ะััั ะกะธะดะพัะพะฒ, ะะฐัะธะฝะฐ ะัะทะฝะตัะพะฒะฐ, ะกะตัะณะตะน ะะพะปะบะพะฒ ะธ ะะปัะณะฐ ะะธะบะพะปะฐะตะฒะฐ. ะัะพะฒะตัะธะป ะธั ะบะฐะปะตะฝะดะฐัะธ ะฝะฐ ัะปะตะดััััั ะฝะตะดะตะปั (ั ััะธะฝะฐะดัะฐัะพะณะพ ะฟะพ ัะตะผะฝะฐะดัะฐัะพะต ัะฝะฒะฐัั) ะธ ะฝะฐััะป ะพะฑัะตะต ัะฒะพะฑะพะดะฝะพะต ะฒัะตะผั: ััะตะดะฐ, ะฟััะฝะฐะดัะฐัะพะณะพ ัะฝะฒะฐัั, ะฒ ัะตัััะฝะฐะดัะฐัั ะฝะพะปั-ะฝะพะปั. ะกะพะทะดะฐะป ัะพะฑััะธะต ะฒ ะบะฐะปะตะฝะดะฐัะต ะฝะฐ ะดะฒะฐ ัะฐัะฐ ั ัะตะผะพะน 'ะัััะตัะฐ ะบะพะผะฐะฝะดั ะฟัะพะตะบัะฐ ะะพััะพะบ' ะธ ะพัะฟัะฐะฒะธะป ะฟัะธะณะปะฐัะตะฝะธั ะฒัะตะผ ััะฐััะฝะธะบะฐะผ. ะัะต ะฟะพะปััะฐั email ั ะดะตัะฐะปัะผะธ ะฒัััะตัะธ ะธ ัััะปะบะพะน ะฝะฐ ะบะฐะปะตะฝะดะฐัะฝะพะต ัะพะฑััะธะต."

---

### ะัะธะผะตั 2: ะะฝะฐะปะธะท ะธ ัะตะทัะผะต ะฟัะพะตะบัะฐ

**User request:**
> "ะะฐะนะดะธ ะฒัะต ะฟะธััะผะฐ ะพ ะฟัะพะตะบัะต ะะพััะพะบ ะทะฐ ะฟะพัะปะตะดะฝะธะน ะผะตััั, ัะพะทะดะฐะน ะฒัััะตัั ะฟะพ ะบะฐะถะดะพะน ะพะฑััะถะดัะฝะฝะพะน ัะตะผะต, ะธ ะพัะฟัะฐะฒั ััะฐััะฝะธะบะฐะผ ัะตะทัะผะต"

**Task breakdown:**

```
Root: "ะัะพะฐะฝะฐะปะธะทะธัะพะฒะฐัั ะฟะตัะตะฟะธัะบั ะธ ะพัะณะฐะฝะธะทะพะฒะฐัั ะฒัััะตัะธ"
โโ 1. "ะะฐะนัะธ ะฒัะต ะฟะธััะผะฐ ะพ ะฟัะพะตะบัะต ะะพััะพะบ ะทะฐ ะผะตััั"
โ   โโ 1.1 "ะัะฟะพะปะฝะธัั RAG ะทะฐะฟัะพั" โ
โโ 2. "ะัะพะฐะฝะฐะปะธะทะธัะพะฒะฐัั ะธ ะฒัะดะตะปะธัั ัะตะผั"
โ   โโ 2.1 "ะะทะฒะปะตัั ะพัะฝะพะฒะฝัะต ัะตะผั ะพะฑััะถะดะตะฝะธั" โ
โ   โโ 2.2 "ะะฟัะตะดะตะปะธัั ััะฐััะฝะธะบะพะฒ ะบะฐะถะดะพะน ัะตะผั" โ
โโ 3. "ะกะพะทะดะฐัั ะฒัััะตัะธ ะฟะพ ะบะฐะถะดะพะน ัะตะผะต"
โ   โโ 3.1 "ะกะพะทะดะฐัั ะฒัััะตัั: ัะตัะฝะธัะตัะบะธะต ััะตะฑะพะฒะฐะฝะธั" โ
โ   โโ 3.2 "ะกะพะทะดะฐัั ะฒัััะตัั: ะฑัะดะถะตั ะฟัะพะตะบัะฐ" โ
โ   โโ 3.3 "ะกะพะทะดะฐัั ะฒัััะตัั: ััะพะบะธ ะทะฐะฟััะบะฐ" โ
โโ 4. "ะัะฟัะฐะฒะธัั ัะตะทัะผะต ััะฐััะฝะธะบะฐะผ"
    โโ 4.1 "ะกะณะตะฝะตัะธัะพะฒะฐัั ะธ ะพัะฟัะฐะฒะธัั email ั ัะตะทัะผะต" โ
```

---

## ะะฝัะตะณัะฐัะธั ั RealtimeAgent

### ะะพะฑะฐะฒะปะตะฝะธะต tool ะฒ ะฐะณะตะฝั

```typescript
// severstalAssistantAgent/index.ts

import { executeComplexTask } from './executeComplexTaskTool';

export const severstalAssistant = new RealtimeAgent({
  name: 'severstalAssistant',
  voice: 'sage',
  instructions: improvedRussianAssistantPrompt,
  tools: [
    hostedMcpTool(/* calendar/email */),
    lightragQueryTool,
    delegateToSupervisor,
    executeComplexTask,  // โ NEW: hierarchical task execution
  ],
});
```

### ะะฑะฝะพะฒะปะตะฝะธะต ะฟัะพะผะฟัะฐ

ะะพะฑะฐะฒะธัั ะฒ `improvedPrompt.ts`:

```markdown
## Tool: executeComplexTask

**ะัะฟะพะปัะทัะน ะดะปั ะะงะะะฌ ะกะะะะะซะฅ ะทะฐะดะฐั (5+ ะฝะตะทะฐะฒะธัะธะผัั ัะฐะณะพะฒ):**

**ะัะธัะตัะธะธ:**
- โ ะะฝะพะถะตััะฒะตะฝะฝะฐั ะบะพะพัะดะธะฝะฐัะธั ะผะตะถะดั ะฟะพะดะทะฐะดะฐัะฐะผะธ
- โ ะะฐะดะฐัะฐ ะทะฐััะฐะณะธะฒะฐะตั ะผะฝะพะถะตััะฒะพ ะปัะดะตะน (ะผะฐััะพะฒะฐั ัะฐัััะปะบะฐ)
- โ ะะฐััะพะฒัะต ะพะฟะตัะฐัะธะธ (10+ ัะพะฑััะธะน, ะฟะธัะตะผ)
- โ ะกะปะพะถะฝัะน ะฐะฝะฐะปะธะท ั ะผะฝะพะถะตััะฒะตะฝะฝัะผะธ ะธััะพัะฝะธะบะฐะผะธ
- โ ะฃัะปะพะฒะฝะฐั ะปะพะณะธะบะฐ ะธ ะทะฐะฒะธัะธะผะพััะธ ะผะตะถะดั ัะฐะณะฐะผะธ

**ะัะธะผะตัั:**
- "ะะฐะนะดะธ ะฒัะตั ััะฐััะฝะธะบะพะฒ ะฟัะพะตะบัะฐ, ะฟัะพะฒะตัั ะบะฐะปะตะฝะดะฐัะธ, ะฝะฐะนะดะธ ะฒัะตะผั, ะพัะฟัะฐะฒั ะฟัะธะณะปะฐัะตะฝะธั"
- "ะัะพะฐะฝะฐะปะธะทะธััะน ะฒัะต ะฟะธััะผะฐ ะทะฐ ะผะตััั, ัะพะทะดะฐะน ะฒัััะตัะธ, ะพัะฟัะฐะฒั ัะตะทัะผะต"

**Preamble:**
ยซะญัะพ ะพัะตะฝั ัะปะพะถะฝะฐั ะทะฐะดะฐัะฐ, ะทะฐะฟััะบะฐั ัะธััะตะผั ะดะตะบะพะผะฟะพะทะธัะธะธ...ยป

**ะะ ะธัะฟะพะปัะทัะน ะดะปั:**
- โ ะัะพัััะต ะทะฐะดะฐัะธ (1-4 ัะฐะณะฐ) โ delegateToSupervisor
- โ ะขะพะปัะบะพ RAG โ lightrag_query
- โ ะะดะธะฝะพัะฝัะต ะดะตะนััะฒะธั โ MCP tools
```

---

## ะะพะฝะธัะพัะธะฝะณ ะธ ะพัะปะฐะดะบะฐ

### Progress Callbacks

```typescript
const orchestrator = new TaskOrchestrator(
  { enableProgressCallbacks: true },
  (update) => {
    console.log(`[Progress] ${update.type}:`, update.taskDescription);
    console.log(`[Progress] ${update.progress}% completed`);

    // ะะพะถะฝะพ ะพัะฟัะฐะฒะปััั ะฒ UI ัะตัะตะท WebSocket:
    // ws.send(JSON.stringify(update));
  }
);
```

### ะะพะณะธัะพะฒะฐะฝะธะต

ะัะต ะพะฟะตัะฐัะธะธ ะปะพะณะธัััััั ั ะฟัะตัะธะบัะพะผ `[TaskOrchestrator]`:

```
[TaskOrchestrator] Starting complex task execution: ะะฐะนะดะธ ะฒัะตั ััะฐััะฝะธะบะพะฒ...
[TaskOrchestrator] Requesting breakdown for task task-root
[TaskOrchestrator] Breaking down task task-root into 4 subtasks
[TaskOrchestrator] Task breakdown complete: totalLeafTasks=7
[TaskOrchestrator] Executing task task-root.0.0: ะัะฟะพะปะฝะธัั RAG ะทะฐะฟัะพั
[TaskOrchestrator] Task task-root.0.0 completed successfully
...
[TaskOrchestrator] Task execution complete: completed=7, failed=0
```

### ะะธะทัะฐะปะธะทะฐัะธั ะดะตัะตะฒะฐ ะทะฐะดะฐั

```typescript
import { formatTaskTreeForDisplay } from './taskOrchestrator';

console.log(formatTaskTreeForDisplay(taskTree.rootTask));
```

Output:
```
โ ะัะณะฐะฝะธะทะพะฒะฐัั ะฒัััะตัั ะบะพะผะฐะฝะดั ะฟัะพะตะบัะฐ ะะพััะพะบ
  โ ะฏ ะพัะณะฐะฝะธะทะพะฒะฐะป ะฒัััะตัั ัะพ ะฒัะตะผะธ ััะฐััะฝะธะบะฐะผะธ...
  โ ะะฐะนัะธ ะฒัะตั ััะฐััะฝะธะบะพะฒ ะฟัะพะตะบัะฐ
    โ ะะฐััะป 6 ััะฐััะฝะธะบะพะฒ: ะะฒะฐะฝ, ะะฝะฝะฐ, ะััั...
    โ ะัะฟะพะปะฝะธัั RAG ะทะฐะฟัะพั
      โ ะะฐะนะดะตะฝะพ 23 ะฟะธััะผะฐ ั ัะฟะพะผะธะฝะฐะฝะธัะผะธ ััะฐััะฝะธะบะพะฒ
    โ ะะทะฒะปะตัั email-ะฐะดัะตัะฐ
      โ ะะทะฒะปะตัะตะฝะพ 6 ะฐะดัะตัะพะฒ
  โ ะัะพะฒะตัะธัั ะบะฐะปะตะฝะดะฐัะธ
    ...
```

---

## ะะณัะฐะฝะธัะตะฝะธั ะธ ะพะฟัะธะผะธะทะฐัะธั

### ะะณัะฐะฝะธัะตะฝะธั

1. **ะะฐะบัะธะผะฐะปัะฝะฐั ะฒะปะพะถะตะฝะฝะพััั:** 5 ััะพะฒะฝะตะน (configurable)
   - ะัะตะดะพัะฒัะฐัะฐะตั ะฑะตัะบะพะฝะตัะฝัั ัะตะบัััะธั
   - ะะพะปััะธะฝััะฒะพ ะทะฐะดะฐั ัะบะปะฐะดัะฒะฐะตััั ะฒ 2-3 ััะพะฒะฝั

2. **ะะฐะบัะธะผัะผ ะฟะพะดะทะฐะดะฐั:** 10 ะฝะฐ ะทะฐะดะฐัั (configurable)
   - ะะฐะปะฐะฝัะธััะตั ะดะตัะฐะปะธะทะฐัะธั ะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั
   - Supervisor ะผะพะถะตั ะณััะฟะฟะธัะพะฒะฐัั ะฟะพัะพะถะธะต ะดะตะนััะฒะธั

3. **ะะพัะปะตะดะพะฒะฐัะตะปัะฝะพะต ะฒัะฟะพะปะฝะตะฝะธะต:** ะะฐะดะฐัะธ ะฒัะฟะพะปะฝััััั ะพะดะฝะฐ ะทะฐ ะดััะณะพะน
   - ะฃะฟัะพัะฐะตั ัะฟัะฐะฒะปะตะฝะธะต ะทะฐะฒะธัะธะผะพัััะผะธ
   - ะ ะฑัะดััะตะผ ะผะพะถะฝะพ ะดะพะฑะฐะฒะธัั ะฟะฐัะฐะปะปะตะปัะฝะพะต ะฒัะฟะพะปะฝะตะฝะธะต ะฝะตะทะฐะฒะธัะธะผัั ะทะฐะดะฐั

4. **ะัะตะผั ะฒัะฟะพะปะฝะตะฝะธั:** ะัะตะฝั ัะปะพะถะฝัะต ะทะฐะดะฐัะธ ะผะพะณัั ะทะฐะฝััั ะผะธะฝััั
   - Supervisor ะฒัะทัะฒะฐะตััั ะฝะตัะบะพะปัะบะพ ัะฐะท (breakdown + execution + report)
   - Realtime user experience ะผะพะถะตั ัััะฐะดะฐัั

### ะะฟัะธะผะธะทะฐัะธะธ

**1. ะััะธัะพะฒะฐะฝะธะต breakdown ัะตะทัะปััะฐัะพะฒ:**
```typescript
// ะัะปะธ ะฟะพัะพะถะฐั ะทะฐะดะฐัะฐ ัะถะต ัะฐะทะฑะธะฒะฐะปะฐัั, ะธัะฟะพะปัะทะพะฒะฐัั ะบัั
const cachedBreakdown = breakdownCache.get(taskSignature);
```

**2. ะะฐัะฐะปะปะตะปัะฝะพะต ะฒัะฟะพะปะฝะตะฝะธะต ะฝะตะทะฐะฒะธัะธะผัั ะทะฐะดะฐั:**
```typescript
// ะะฐะดะฐัะธ ะฑะตะท ะทะฐะฒะธัะธะผะพััะตะน ะดััะณ ะพั ะดััะณะฐ ะผะพะถะฝะพ ะฒัะฟะพะปะฝััั ะฟะฐัะฐะปะปะตะปัะฝะพ
await Promise.all([
  executeTask(task1),
  executeTask(task2),
  executeTask(task3),
]);
```

**3. ะะฐะฝะฝัั ะพััะฐะฝะพะฒะบะฐ:**
```typescript
// ะัะปะธ ะบัะธัะธัะตัะบะฐั ะทะฐะดะฐัะฐ ะฟัะพะฒะฐะปะธะปะฐัั, ะพััะฐะฝะพะฒะธัั ะฒัะฟะพะปะฝะตะฝะธะต
if (task.isCritical && task.status === 'failed') {
  throw new Error('Critical task failed, stopping execution');
}
```

**4. Streaming results:**
```typescript
// ะัะฟัะฐะฒะปััั ะฟัะพะผะตะถััะพัะฝัะต ัะตะทัะปััะฐัั ะฟะพะปัะทะพะฒะฐัะตะปั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
orchestrator.on('task_completed', (task) => {
  realtimeAgent.speak(`ะัะฟะพะปะฝะตะฝะพ: ${task.description}`);
});
```

---

## ะะฐะปัะฝะตะนัะตะต ัะฐะทะฒะธัะธะต

### ะะปะฐะฝะธััะตะผัะต ัะปัััะตะฝะธั

1. **ะะพะดะดะตัะถะบะฐ ะฟะฐัะฐะปะปะตะปะธะทะผะฐ**
   - ะัะฟะพะปะฝะตะฝะธะต ะฝะตะทะฐะฒะธัะธะผัั ะทะฐะดะฐั ะพะดะฝะพะฒัะตะผะตะฝะฝะพ
   - ะะฝะฐัะธัะตะปัะฝะพ ััะบะพัะธั ะฒัะฟะพะปะฝะตะฝะธะต

2. **Retry mechanism**
   - ะะฒัะพะผะฐัะธัะตัะบะธะน retry ะฟัะธ ะฒัะตะผะตะฝะฝัั ะพัะธะฑะบะฐั
   - Exponential backoff

3. **Task prioritization**
   - ะัะธัะธัะตัะบะธะต ะทะฐะดะฐัะธ ะฒัะฟะพะปะฝััััั ะฟะตัะฒัะผะธ
   - ะะตะบัะธัะธัะฝัะต ะผะพะถะฝะพ ะฟัะพะฟัััะธัั ะฟัะธ ะพัะธะฑะบะฐั

4. **Persistense & resume**
   - ะกะพััะฐะฝะตะฝะธะต ัะพััะพัะฝะธั TaskTree ะฒ DB
   - ะะพะทะผะพะถะฝะพััั ะฟัะพะดะพะปะถะธัั ะฒัะฟะพะปะฝะตะฝะธะต ะฟะพัะปะต ะฟะตัะตะทะฐะฟััะบะฐ

5. **UI ะดะปั ะพัะพะฑัะฐะถะตะฝะธั ะฟัะพะณัะตััะฐ**
   - ะะธะทัะฐะปะธะทะฐัะธั ะดะตัะตะฒะฐ ะทะฐะดะฐั
   - Real-time progress bars
   - ะะฝัะตัะฐะบัะธะฒะฝะพะต ัะฟัะฐะฒะปะตะฝะธะต (pause/resume/cancel)

6. **Adaptive breakdown**
   - ML-ะผะพะดะตะปั ะดะปั ะฟัะตะดัะบะฐะทะฐะฝะธั ะพะฟัะธะผะฐะปัะฝะพะณะพ ัะฐะทะฑะธะตะฝะธั
   - ะะฑััะตะฝะธะต ะฝะฐ ััะฟะตัะฝัั ะฒัะฟะพะปะฝะตะฝะธัั

---

## ะะฐะบะปััะตะฝะธะต

ะกะธััะตะผะฐ ะธะตัะฐััะธัะตัะบะพะณะพ ะฒัะฟะพะปะฝะตะฝะธั ะทะฐะดะฐั ัะตัะฐะตั ะฟัะพะฑะปะตะผั **ะะงะะะฌ ะกะะะะะซะฅ multi-step ะทะฐะดะฐั**, ะบะพัะพััะต ะฝะต ะผะพะณัั ะฑััั ัััะตะบัะธะฒะฝะพ ะฒัะฟะพะปะฝะตะฝั ะฒ ะพะดะธะฝ ะทะฐะฟัะพั ะบ supervisor.

**ะะปััะตะฒัะต ะฟัะตะธะผััะตััะฒะฐ:**
- โ ะะฒัะพะผะฐัะธัะตัะบะพะต ัะตะบัััะธะฒะฝะพะต ัะฐะทะฑะธะตะฝะธะต
- โ ะะพะดะดะตัะถะบะฐ ะฒะปะพะถะตะฝะฝะพััะธ ะดะพ 5 ััะพะฒะฝะตะน
- โ ะฃััั ะทะฐะฒะธัะธะผะพััะตะน ะผะตะถะดั ะทะฐะดะฐัะฐะผะธ
- โ ะะตัะฐััะธัะตัะบะธะน ัะฑะพั ัะตะทัะปััะฐัะพะฒ
- โ ะะตัะฐะปัะฝัะน ัะธะฝะฐะปัะฝัะน ะพัััั
- โ ะัะพะทัะฐัะฝะพััั ะฒัะฟะพะปะฝะตะฝะธั (ะปะพะณะธ, callbacks)

**ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั:**
- 5+ ะฝะตะทะฐะฒะธัะธะผัั ัะฐะณะพะฒ
- ะะฝะพะถะตััะฒะตะฝะฝะฐั ะบะพะพัะดะธะฝะฐัะธั
- ะะฐััะพะฒัะต ะพะฟะตัะฐัะธะธ
- ะกะปะพะถะฝัะน ะฐะฝะฐะปะธะท

**ะะพะณะดะฐ ะะ ะธัะฟะพะปัะทะพะฒะฐัั:**
- ะัะพัััะต ะทะฐะดะฐัะธ (1-4 ัะฐะณะฐ) โ `delegateToSupervisor`
- ะขะพะปัะบะพ RAG ะทะฐะฟัะพั โ `lightrag_query`
- ะะดะธะฝะพัะฝัะต ะดะตะนััะฒะธั โ MCP tools ะฝะฐะฟััะผัั

---

**ะะพัะพะฒะพ!** ๐

ะกะธััะตะผะฐ ะณะพัะพะฒะฐ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั. ะกะปะตะดัััะธะน ัะฐะณ - ะธะฝัะตะณัะฐัะธั ั RealtimeAgent ะธ ัะตััะธัะพะฒะฐะฝะธะต ะฝะฐ ัะตะฐะปัะฝัั ัะปะพะถะฝัั ะทะฐะดะฐัะฐั.
