# IntelligentSupervisor - Architecture Documentation

**Version:** 1.0
**Date:** 2025-10-24
**Status:** Production Ready

---

## Table of Contents

1. [System Overview](#system-overview)
2. [Component Diagram](#component-diagram)
3. [Data Flow](#data-flow)
4. [Strategy Selection Logic](#strategy-selection-logic)
5. [Execution Strategies](#execution-strategies)
6. [Progress Tracking Architecture](#progress-tracking-architecture)
7. [Error Handling](#error-handling)
8. [Performance Considerations](#performance-considerations)

---

## System Overview

IntelligentSupervisor â€” ÑÑ‚Ğ¾ **Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡** Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¼ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ¾Ğ¼ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸.

### Core Responsibilities

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              IntelligentSupervisor Core                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ASSESS    â†’ Evaluate task complexity (simple/medium/    â”‚
â”‚                complex) using supervisorAgent              â”‚
â”‚ 2. SELECT    â†’ Choose execution strategy (direct/flat/     â”‚
â”‚                hierarchical)                                â”‚
â”‚ 3. EXECUTE   â†’ Run task with selected strategy             â”‚
â”‚ 4. TRACK     â†’ Emit progress events via SSE                â”‚
â”‚ 5. RESPOND   â†’ Return unified response format              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Diagram

### Full System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT LAYER                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   RealtimeAgent (UI)     â”‚     â”‚   SSE Client (Progress UI)    â”‚ â”‚
â”‚  â”‚  - User voice/chat input â”‚     â”‚  - Subscribes to sessionId    â”‚ â”‚
â”‚  â”‚  - Tool selection        â”‚     â”‚  - Displays 0-100% progress   â”‚ â”‚
â”‚  â”‚  - Speaks responses      â”‚     â”‚  - Shows current step         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                                 â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                 â”‚
            â”‚ delegateToIntelligentSupervisor â”‚ GET /api/supervisor/progress/:sessionId
            â”‚                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           â–¼                  TOOL LAYER     â”‚                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                         â”‚
â”‚  â”‚ intelligentSupervisorTool.ts           â”‚ â”‚                         â”‚
â”‚  â”‚                                        â”‚ â”‚                         â”‚
â”‚  â”‚ 1. Generate sessionId                  â”‚ â”‚                         â”‚
â”‚  â”‚ 2. Create TASK_PROGRESS message        â”‚ â”‚                         â”‚
â”‚  â”‚ 3. Call POST /api/supervisor/unified   â”‚â”€â”¼â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ 4. Add breadcrumbs for workflowSteps  â”‚ â”‚     â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚                   â”‚
â”‚                                             â”‚     â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚     â”‚
                                              â”‚     â”‚ HTTP POST with sessionId
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              API LAYER                      â”‚     â–¼                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ unified/route.ts (POST /api/supervisor/unified)                 â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ 1. Validate parameters                                          â”‚ â”‚
â”‚  â”‚ 2. Create IntelligentSupervisor({ sessionId })                 â”‚ â”‚
â”‚  â”‚ 3. Call supervisor.execute(request)                            â”‚ â”‚
â”‚  â”‚ 4. Return UnifiedResponse                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ORCHESTRATOR LAYER                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ IntelligentSupervisor (intelligentSupervisor.ts)               â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚  execute(request) {                                            â”‚ â”‚
â”‚  â”‚    1. assessComplexity()      â”€â”€> supervisorAgent             â”‚ â”‚
â”‚  â”‚    2. selectStrategy()         â”€â”€> simple/medium/complex      â”‚ â”‚
â”‚  â”‚    3. switch (strategy) {                                     â”‚ â”‚
â”‚  â”‚         case 'direct':        â”€â”€> executeDirectly()           â”‚ â”‚
â”‚  â”‚         case 'flat':          â”€â”€> executeFlatWorkflow()       â”‚ â”‚
â”‚  â”‚         case 'hierarchical':  â”€â”€> executeHierarchical()       â”‚ â”‚
â”‚  â”‚       }                                                        â”‚ â”‚
â”‚  â”‚    4. emitProgress()          â”€â”€> progressEmitter (SSE)       â”‚ â”‚
â”‚  â”‚    5. return UnifiedResponse                                  â”‚ â”‚
â”‚  â”‚  }                                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                   â”‚                   â”‚                 â”‚
â”‚           â–¼                   â–¼                   â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ DIRECT       â”‚  â”‚ FLAT             â”‚  â”‚ HIERARCHICAL         â”‚ â”‚
â”‚  â”‚ (simple)     â”‚  â”‚ (medium)         â”‚  â”‚ (complex)            â”‚ â”‚
â”‚  â”‚              â”‚  â”‚                  â”‚  â”‚                      â”‚ â”‚
â”‚  â”‚ 1 step       â”‚  â”‚ 2-7 steps        â”‚  â”‚ 8+ steps             â”‚ â”‚
â”‚  â”‚ supervisor   â”‚  â”‚ multi-step       â”‚  â”‚ TaskOrchestrator     â”‚ â”‚
â”‚  â”‚ executes     â”‚  â”‚ workflow         â”‚  â”‚ recursive breakdown  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                  â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TASK DECOMPOSITION LAYER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ TaskOrchestrator (taskOrchestrator.ts)                         â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚  executeComplexTask() {                                        â”‚ â”‚
â”‚  â”‚    1. Create root task                                         â”‚ â”‚
â”‚  â”‚    2. breakdownTask() recursively  â”€â”€> supervisorAgent        â”‚ â”‚
â”‚  â”‚    3. calculateExecutionOrder()    â”€â”€> depth-first + deps     â”‚ â”‚
â”‚  â”‚    4. executeTasks() sequentially  â”€â”€> supervisorAgent        â”‚ â”‚
â”‚  â”‚    5. collectResults() hierarchically                          â”‚ â”‚
â”‚  â”‚    6. generateReport()             â”€â”€> supervisorAgent        â”‚ â”‚
â”‚  â”‚  }                                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â”‚  Task Tree Structure:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ task-root (complex)                                           â”‚ â”‚
â”‚  â”‚   â”œâ”€ task-root.0 (moderate)                                   â”‚ â”‚
â”‚  â”‚   â”‚   â”œâ”€ task-root.0.0 (simple) âœ“                            â”‚ â”‚
â”‚  â”‚   â”‚   â””â”€ task-root.0.1 (simple) âœ“                            â”‚ â”‚
â”‚  â”‚   â”œâ”€ task-root.1 (simple) âœ“                                  â”‚ â”‚
â”‚  â”‚   â””â”€ task-root.2 (complex)                                    â”‚ â”‚
â”‚  â”‚       â”œâ”€ task-root.2.0 (simple) âœ“                            â”‚ â”‚
â”‚  â”‚       â””â”€ task-root.2.1 (simple) âœ“                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AI AGENT LAYER                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ SupervisorAgent (agent.ts) - GPT-4o                            â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ Instructions: supervisorAgentInstructions (551 lines)          â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ Used by:                                                       â”‚ â”‚
â”‚  â”‚  - assessComplexity()           (complexity assessment)        â”‚ â”‚
â”‚  â”‚  - executeDirectly()            (simple tasks)                 â”‚ â”‚
â”‚  â”‚  - executeFlatWorkflow()        (medium tasks)                 â”‚ â”‚
â”‚  â”‚  - breakdownTaskWithSupervisor() (hierarchical breakdown)     â”‚ â”‚
â”‚  â”‚  - executeSingleTaskWithAgent()  (hierarchical execution)      â”‚ â”‚
â”‚  â”‚  - generateReportWithSupervisor() (hierarchical report)        â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ Tools:                                                         â”‚ â”‚
â”‚  â”‚  - hostedMcpTool (calendar/email operations)                  â”‚ â”‚
â”‚  â”‚  - RAG MCP (knowledge retrieval)                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PROGRESS LAYER                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ProgressEmitter (progressEmitter.ts) - EventEmitter singleton  â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ emitProgress(update: ProgressUpdate) {                         â”‚ â”‚
â”‚  â”‚   this.emit(`progress:${sessionId}`, update)                  â”‚ â”‚
â”‚  â”‚ }                                                              â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚ Progress Events:                                               â”‚ â”‚
â”‚  â”‚  - started              (0%)                                   â”‚ â”‚
â”‚  â”‚  - complexity_assessed  (20%)                                  â”‚ â”‚
â”‚  â”‚  - strategy_selected    (30%)                                  â”‚ â”‚
â”‚  â”‚  - step_started         (40-70%)                               â”‚ â”‚
â”‚  â”‚  - step_completed       (70-90%)                               â”‚ â”‚
â”‚  â”‚  - completed            (100%)                                 â”‚ â”‚
â”‚  â”‚  - error                (0% with error details)                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â”‚  SSE Route: /api/supervisor/progress/:sessionId                     â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â””â”€> EventSource client subscribes to session-specific events       â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow

### End-to-End Request Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: User Request                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
User: "ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ¹ Ğ¿Ğ¸ÑÑŒĞ¼Ğ¾ Ğ¾Ñ‚ ĞĞ½Ğ½Ñ‹ Ğ¸ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ÑŒ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ñƒ Ğ½Ğ° Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ"
  â”‚
  â–¼
RealtimeAgent detects complexity (2+ steps)
  â”‚
  â–¼
delegateToIntelligentSupervisor({
  taskDescription: "...",
  conversationContext: "..."
})

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Tool Execution                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
intelligentSupervisorTool.execute()
  â”‚
  â”œâ”€> Generate sessionId = "session-1234-abcd"
  â”‚
  â”œâ”€> addTaskProgressMessage(sessionId, taskDescription)
  â”‚   â””â”€> Creates TASK_PROGRESS component in transcript
  â”‚
  â””â”€> POST /api/supervisor/unified
      Body: {
        taskDescription,
        conversationContext,
        executionMode: "auto",
        sessionId: "session-1234-abcd"
      }

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: API Handling                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
unified/route.ts
  â”‚
  â”œâ”€> Validate parameters
  â”‚
  â”œâ”€> Create supervisor = new IntelligentSupervisor({
  â”‚     sessionId: "session-1234-abcd",
  â”‚     maxComplexity: "hierarchical"
  â”‚   })
  â”‚
  â””â”€> result = supervisor.execute(request)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Complexity Assessment                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
IntelligentSupervisor.execute()
  â”‚
  â”œâ”€> emitProgress('started', 'ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ...', 0%)
  â”‚
  â”œâ”€> assessComplexity(taskDescription, conversationContext)
  â”‚   â”‚
  â”‚   â””â”€> Prompt to supervisorAgent:
  â”‚       "ĞÑ†ĞµĞ½Ğ¸ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸: ..."
  â”‚       Response: {
  â”‚         complexity: "medium",
  â”‚         reasoning: "2-7 ÑˆĞ°Ğ³Ğ¾Ğ², ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ Ğ½ÑƒĞ¶Ğ½Ğ°"
  â”‚       }
  â”‚
  â””â”€> emitProgress('complexity_assessed', 'Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ: medium', 20%)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Strategy Selection                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
selectStrategy(complexity = "medium")
  â”‚
  â”œâ”€> if (complexity === "simple")   â†’ strategy = "direct"
  â”œâ”€> if (complexity === "medium")   â†’ strategy = "flat"
  â””â”€> if (complexity === "complex")  â†’ strategy = "hierarchical"
  â”‚
  â”œâ”€> Selected: strategy = "flat"
  â”‚
  â””â”€> emitProgress('strategy_selected', 'Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ: flat', 30%)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: Execution (FLAT Strategy)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
executeFlatWorkflow(request)
  â”‚
  â”œâ”€> emitProgress('step_started', 'Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ÑˆĞ°Ğ³Ğ¾Ğ²ÑƒÑ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ...', 40%)
  â”‚
  â”œâ”€> Prompt to supervisorAgent:
  â”‚   "Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ ÑÑ€ĞµĞ´Ğ½ĞµĞ¹ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸: ..."
  â”‚   "Ğ’ĞµÑ€Ğ½Ğ¸ JSON: { nextResponse, workflowSteps }"
  â”‚
  â”œâ”€> SupervisorAgent executes:
  â”‚   â”‚
  â”‚   â”œâ”€> Step 1: Read email from Anna (Calendar MCP)
  â”‚   â”œâ”€> Step 2: Extract meeting time from content
  â”‚   â”œâ”€> Step 3: Check calendar for conflicts (Calendar MCP)
  â”‚   â””â”€> Step 4: Create calendar event (Calendar MCP)
  â”‚
  â””â”€> Response from supervisorAgent:
      {
        "nextResponse": "Ğ¯ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ» Ğ¿Ğ¸ÑÑŒĞ¼Ğ¾ Ğ¾Ñ‚ ĞĞ½Ğ½Ñ‹...",
        "workflowSteps": [
          "ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ» Ğ¿Ğ¸ÑÑŒĞ¼Ğ¾ Ğ¾Ñ‚ ĞĞ½Ğ½Ñ‹ Ğ¾Ñ‚ 22 ÑĞ½Ğ²Ğ°Ñ€Ñ 10:30",
          "Ğ˜Ğ·Ğ²Ğ»Ñ‘Ğº Ğ²Ñ€ĞµĞ¼Ñ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğ¸: ÑÑ€ĞµĞ´Ğ° 15 ÑĞ½Ğ²Ğ°Ñ€Ñ 15:00",
          "ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ğ» ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ â€” ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾",
          "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ» ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ² ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ğµ: ÑÑ€ĞµĞ´Ğ° 15:00-16:00"
        ]
      }
  â”‚
  â””â”€> emitProgress('step_completed', 'Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ° (4 ÑˆĞ°Ğ³Ğ°)', 90%)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 7: Response Building                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
IntelligentSupervisor.execute() returns:
{
  strategy: "flat",
  complexity: "medium",
  nextResponse: "Ğ¯ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ» Ğ¿Ğ¸ÑÑŒĞ¼Ğ¾ Ğ¾Ñ‚ ĞĞ½Ğ½Ñ‹...",
  workflowSteps: [ ... ],
  progress: { current: 4, total: 4 },
  executionTime: 2350
}
  â”‚
  â””â”€> emitProgress('completed', 'Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ°', 100%)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 8: Tool Result Processing                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
intelligentSupervisorTool receives result
  â”‚
  â”œâ”€> addBreadcrumb('[Intelligent Supervisor] Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾')
  â”‚
  â”œâ”€> For each workflowStep:
  â”‚     addBreadcrumb('[Intelligent Supervisor] Ğ¨Ğ°Ğ³ 1/4', { step })
  â”‚
  â””â”€> Return to RealtimeAgent:
      {
        success: true,
        strategy: "flat",
        complexity: "medium",
        nextResponse: "...",
        workflowSteps: [ ... ]
      }

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 9: User Response                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
RealtimeAgent receives tool result
  â”‚
  â””â”€> Speaks nextResponse to user:
      "Ğ¯ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ» Ğ¿Ğ¸ÑÑŒĞ¼Ğ¾ Ğ¾Ñ‚ ĞĞ½Ğ½Ñ‹, Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ğ¾Ğµ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ ÑƒÑ‚Ñ€Ğ¾Ğ¼.
       ĞĞ½Ğ° Ğ¿Ñ€ĞµĞ´Ğ»Ğ°Ğ³Ğ°ĞµÑ‚ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ñƒ Ğ² ÑÑ€ĞµĞ´Ñƒ, Ğ¿ÑÑ‚Ğ½Ğ°Ğ´Ñ†Ğ°Ñ‚Ğ¾Ğ³Ğ¾ ÑĞ½Ğ²Ğ°Ñ€Ñ..."
```

---

## Strategy Selection Logic

### Decision Tree

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ assessComplexity(task, context)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ SupervisorAgent      â”‚
              â”‚ Analyzes task with:  â”‚
              â”‚ - Step count         â”‚
              â”‚ - Data sources       â”‚
              â”‚ - Coordination needs â”‚
              â”‚ - Conditional logic  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Complexity Assessment Result       â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚          â”‚          â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   SIMPLE    â”‚  â”‚MEDIUM â”‚  â”‚  COMPLEX   â”‚
     â”‚             â”‚  â”‚       â”‚  â”‚            â”‚
     â”‚ 1 step      â”‚  â”‚2-7    â”‚  â”‚ 8+ steps   â”‚
     â”‚ Clear paramsâ”‚  â”‚steps  â”‚  â”‚ Multiple   â”‚
     â”‚ No logic    â”‚  â”‚Coord  â”‚  â”‚ sources    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚          â”‚          â”‚
              â–¼          â–¼          â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ DIRECT â”‚ â”‚  FLAT  â”‚ â”‚ HIERARCHICAL â”‚
         â”‚Strategyâ”‚ â”‚Strategyâ”‚ â”‚  Strategy    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Complexity Criteria

```typescript
// assessComplexity() prompt to supervisorAgent:

**simple** (1 step):
  âœ… Single action with clear parameters
  âœ… No conditional logic needed
  âœ… No cross-referencing
  âŒ Examples:
     - "ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ¹ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¿Ğ¸ÑÑŒĞ¼Ğ¾"
     - "ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğ¸ Ğ½Ğ° Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°"

**medium** (2-7 steps):
  âœ… Multiple sequential steps with dependencies
  âœ… May require conditional logic
  âœ… Coordination between steps needed
  âŒ Examples:
     - "ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ¹ Ğ¿Ğ¸ÑÑŒĞ¼Ğ¾ Ğ¾Ñ‚ ĞĞ½Ğ½Ñ‹ Ğ¸ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ÑŒ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ñƒ"
     - "ĞĞ°Ğ¹Ğ´Ğ¸ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ¹ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ"

**complex** (8+ steps):
  âœ… Many steps (8+)
  âœ… Multiple data sources
  âœ… Mass operations (many people, events)
  âœ… Requires hierarchical decomposition
  âŒ Examples:
     - "ĞĞ°Ğ¹Ğ´Ğ¸ Ğ²ÑĞµÑ… ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ÑŒ Ğ¿Ñ€Ğ¸Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¸Ñ"
     - "ĞŸÑ€Ğ¾Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞ¹ Ğ¿ĞµÑ€ĞµĞ¿Ğ¸ÑĞºÑƒ Ğ·Ğ° Ğ¼ĞµÑÑÑ†"
```

---

## Execution Strategies

### Strategy 1: DIRECT (Simple Tasks)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ executeDirectly(request)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Prompt to SupervisorAgent:                                  â”‚
â”‚ "Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸ Ğ¿Ñ€Ğ¾ÑÑ‚ÑƒÑ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ: [task]"                           â”‚
â”‚ "Ğ’ĞµÑ€Ğ½Ğ¸ JSON: { nextResponse, workflowSteps }"              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ SupervisorAgentâ”‚
         â”‚ executes with  â”‚
         â”‚ 1 MCP tool callâ”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Result:                                                    â”‚
â”‚ {                                                          â”‚
â”‚   "nextResponse": "ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¿Ğ¸ÑÑŒĞ¼Ğ¾ Ğ¾Ñ‚ Ğ˜Ğ³Ğ¾Ñ€Ñ Ğ¾ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğµ...",â”‚
â”‚   "workflowSteps": ["ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ» Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¿Ğ¸ÑÑŒĞ¼Ğ¾"]          â”‚
â”‚ }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Characteristics:**
- âœ… Fast (1 supervisorAgent call)
- âœ… Low latency
- âœ… Suitable for straightforward tasks

### Strategy 2: FLAT (Medium Tasks)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ executeFlatWorkflow(request)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Prompt to SupervisorAgent:                                  â”‚
â”‚ "Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ÑˆĞ°Ğ³Ğ¾Ğ²ÑƒÑ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ: [task]"                      â”‚
â”‚ "Ğ’ĞµÑ€Ğ½Ğ¸ JSON: { nextResponse, workflowSteps }"              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ SupervisorAgent    â”‚
         â”‚ executes workflow: â”‚
         â”‚                    â”‚
         â”‚ Step 1: Tool call  â”‚
         â”‚ Step 2: Tool call  â”‚
         â”‚ Step 3: Logic      â”‚
         â”‚ Step 4: Tool call  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Result:                                                    â”‚
â”‚ {                                                          â”‚
â”‚   "nextResponse": "Ğ¯ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ» Ğ¿Ğ¸ÑÑŒĞ¼Ğ¾ Ğ¾Ñ‚ ĞĞ½Ğ½Ñ‹... (80 ÑĞ»Ğ¾Ğ²)",â”‚
â”‚   "workflowSteps": [                                       â”‚
â”‚     "ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ» Ğ¿Ğ¸ÑÑŒĞ¼Ğ¾ Ğ¾Ñ‚ ĞĞ½Ğ½Ñ‹",                            â”‚
â”‚     "Ğ˜Ğ·Ğ²Ğ»Ñ‘Ğº Ğ²Ñ€ĞµĞ¼Ñ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğ¸",                               â”‚
â”‚     "ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ğ» ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ",                                 â”‚
â”‚     "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ» ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ"                                      â”‚
â”‚   ]                                                        â”‚
â”‚ }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Characteristics:**
- âœ… Sequential tool calls with coordination
- âœ… Conditional logic supported
- âœ… Detailed nextResponse (40-100+ words)
- âœ… workflowSteps always included

### Strategy 3: HIERARCHICAL (Complex Tasks)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ executeHierarchical(request)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create TaskOrchestrator with config:                        â”‚
â”‚ - maxNestingLevel: 5                                        â”‚
â”‚ - maxSubtasksPerTask: 10                                    â”‚
â”‚ - enableProgressCallbacks: true                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TaskOrchestrator.executeComplexTask()                       â”‚
â”‚                                                             â”‚
â”‚ Phase 1: BREAKDOWN                                          â”‚
â”‚   â”œâ”€> Root task: "ĞÑ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ñƒ"                   â”‚
â”‚   â”œâ”€> breakdownTaskWithSupervisor(root)                   â”‚
â”‚   â”‚   â””â”€> Returns: [Subtask 1, Subtask 2, Subtask 3]     â”‚
â”‚   â”œâ”€> Recursively breakdown complex subtasks               â”‚
â”‚   â””â”€> Build Task Tree                                      â”‚
â”‚                                                             â”‚
â”‚ Phase 2: EXECUTION                                          â”‚
â”‚   â”œâ”€> Calculate execution order (depth-first, deps)        â”‚
â”‚   â”œâ”€> For each leaf task:                                  â”‚
â”‚   â”‚   â””â”€> executeSingleTaskWithAgent(task)                â”‚
â”‚   â””â”€> Update task status (completed/failed)                â”‚
â”‚                                                             â”‚
â”‚ Phase 3: COLLECTION                                         â”‚
â”‚   â”œâ”€> Collect results hierarchically (bottom-up)           â”‚
â”‚   â”œâ”€> Parent tasks aggregate subtask results               â”‚
â”‚   â””â”€> Build hierarchicalBreakdown                          â”‚
â”‚                                                             â”‚
â”‚ Phase 4: REPORTING                                          â”‚
â”‚   â””â”€> generateReportWithSupervisor(taskTree)              â”‚
â”‚       â””â”€> Returns: FinalReport                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FinalReport:                                               â”‚
â”‚ {                                                          â”‚
â”‚   "summary": "Ğ¯ Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ» Ğ²ÑÑ‚Ñ€ĞµÑ‡Ñƒ... (2-3 sentences)",  â”‚
â”‚   "detailedResults": "ĞĞ°ÑˆÑ‘Ğ» 6 ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ²... (100+ words)",â”‚
â”‚   "tasksCompleted": 7,                                     â”‚
â”‚   "tasksFailed": 0,                                        â”‚
â”‚   "executionTime": 12500,                                  â”‚
â”‚   "hierarchicalBreakdown": { taskTree }                   â”‚
â”‚ }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Characteristics:**
- âœ… Recursive breakdown (up to 5 levels)
- âœ… Dependency management
- âœ… Parallel execution potential (future)
- âœ… Detailed hierarchical structure
- âš ï¸ Slower (multiple supervisorAgent calls)

---

## Progress Tracking Architecture

### SSE Event Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IntelligentSupervisor.execute()                              â”‚
â”‚ (sessionId = "session-1234-abcd")                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ emitProgress()
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProgressEmitter (singleton EventEmitter)                     â”‚
â”‚                                                              â”‚
â”‚ emitProgress(update: ProgressUpdate) {                       â”‚
â”‚   this.emit(`progress:${sessionId}`, update)                â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ event: "progress:session-1234-abcd"
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SSE Route: /api/supervisor/progress/:sessionId               â”‚
â”‚                                                              â”‚
â”‚ GET /api/supervisor/progress/session-1234-abcd               â”‚
â”‚                                                              â”‚
â”‚ const listener = (update) => {                               â”‚
â”‚   res.write(`data: ${JSON.stringify(update)}\n\n`)          â”‚
â”‚ }                                                            â”‚
â”‚ progressEmitter.onProgress(sessionId, listener)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ SSE stream
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client (UI) - EventSource                                    â”‚
â”‚                                                              â”‚
â”‚ const eventSource = new EventSource(                         â”‚
â”‚   `/api/supervisor/progress/${sessionId}`                   â”‚
â”‚ )                                                            â”‚
â”‚                                                              â”‚
â”‚ eventSource.onmessage = (event) => {                         â”‚
â”‚   const update = JSON.parse(event.data)                     â”‚
â”‚   updateProgressUI(update.progress, update.message)          â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Progress Event Timeline

```
Time  Progress  Event Type           Message
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0ms    0%      started              "ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ..."
500ms  10%     complexity_assessed  "ĞÑ†ĞµĞ½Ğ¸Ğ²Ğ°Ñ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ..."
1000ms 20%     complexity_assessed  "Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ: medium"
1200ms 30%     strategy_selected    "Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ: flat"
1500ms 40%     step_started         "Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑ ÑˆĞ°Ğ³ 1..."
2000ms 60%     step_started         "Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑ ÑˆĞ°Ğ³ 2..."
2500ms 80%     step_started         "Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑ ÑˆĞ°Ğ³ 3..."
3000ms 90%     step_completed       "Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ° (4 ÑˆĞ°Ğ³Ğ°)"
3200ms 100%    completed            "Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾"
```

**See:** [PROGRESS_TRACKING.md](./PROGRESS_TRACKING.md) for implementation details.

---

## Error Handling

### Error Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Any execution method throws error                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ try/catch block â”‚
               â”‚ in execute()    â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ emitProgress('error', ...)   â”‚
         â”‚ - type: 'error'              â”‚
         â”‚ - progress: 0                â”‚
         â”‚ - details: { error }         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Return error response:       â”‚
         â”‚ {                            â”‚
         â”‚   success: false,            â”‚
         â”‚   error: error.message,      â”‚
         â”‚   fallbackResponse: "..."    â”‚
         â”‚ }                            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Error Types

| Error Source | Handling Strategy | User Impact |
|--------------|-------------------|-------------|
| Complexity assessment fails | Default to `medium` | Minimal â€” uses fallback |
| SupervisorAgent timeout | Throw error, emit SSE | Error message shown |
| Tool call fails (MCP) | SupervisorAgent retries | Task marked as failed |
| TaskOrchestrator breakdown fails | Return partial results | Some subtasks incomplete |
| JSON parse error | Fallback response | Generic error message |

---

## Performance Considerations

### Latency Comparison

| Strategy | Complexity | Avg Time | SupervisorAgent Calls | MCP Calls |
|----------|------------|----------|----------------------|-----------|
| DIRECT | simple | 1-2s | 1 | 1 |
| FLAT | medium | 2-5s | 1 | 2-7 |
| HIERARCHICAL | complex | 10-30s | 5-20 | 8+ |

### Optimization Strategies

1. **Caching complexity assessments** (future)
   - Cache assessment results for similar tasks
   - Reduce supervisorAgent calls

2. **Parallel execution** (future)
   - Execute independent subtasks concurrently
   - Reduce hierarchical execution time

3. **Streaming responses** (partial)
   - SSE progress events provide real-time feedback
   - User perceives lower latency

4. **Task prioritization** (future)
   - Critical tasks execute first
   - Non-critical tasks can be skipped on errors

---

## Related Documentation

- [README.md](./README.md) â€” Overview and integration guide
- [SUPERVISOR_PROMPT_GUIDE.md](./SUPERVISOR_PROMPT_GUIDE.md) â€” Prompt engineering details
- [TASK_ORCHESTRATOR_INTEGRATION.md](./TASK_ORCHESTRATOR_INTEGRATION.md) â€” Hierarchical execution
- [PROGRESS_TRACKING.md](./PROGRESS_TRACKING.md) â€” SSE implementation

---

**ğŸ¯ Architecture designed for adaptive, scalable task execution with automatic complexity detection.**
