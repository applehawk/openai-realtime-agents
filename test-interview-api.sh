#!/bin/bash

# –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API –∏–Ω—Ç–µ—Ä–≤—å—é
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./test-interview-api.sh

echo "üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –∏–Ω—Ç–µ—Ä–≤—å—é..."
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
echo "1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
HEALTH_RESPONSE=$(curl -s http://localhost:3000/api/health)
if [[ $HEALTH_RESPONSE == *"ok"* ]]; then
    echo "‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ"
else
    echo "‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ"
    exit 1
fi

echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∏–Ω—Ç–µ—Ä–≤—å—é –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
echo "2. –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∏–Ω—Ç–µ—Ä–≤—å—é –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏..."
INTERVIEW_RESPONSE=$(curl -s -X POST http://localhost:3000/api/interview \
  -H "Content-Type: application/json" \
  -d '{"action": "check_status"}')

if [[ $INTERVIEW_RESPONSE == *"Not authenticated"* ]]; then
    echo "‚úÖ API –∏–Ω—Ç–µ—Ä–≤—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ç—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)"
else
    echo "‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç: $INTERVIEW_RESPONSE"
fi

echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
echo "3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è RAG..."
RAG_VARS=$(docker compose exec -T realtime-agents env | grep RAG)
echo "üìã –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ RAG:"
echo "$RAG_VARS"

echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
echo "4. –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞..."
CONTAINER_STATUS=$(docker compose ps --format "table {{.Name}}\t{{.Status}}")
echo "üìã –°—Ç–∞—Ç—É—Å:"
echo "$CONTAINER_STATUS"

echo ""
echo "üéâ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –ü–†–ï–î–õ–û–ñ–ï–ù–ò–ï –ò–ù–¢–ï–†–í–¨–Æ:"
echo "‚úÖ –ê–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ—Ä–≤—å—é –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏"
echo "‚úÖ –ù–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–≤—å—é"
echo "‚úÖ –£–º–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ—Ä–≤—å—é"
echo "‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤—å—é"
echo ""
echo "üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:"
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: http://localhost:3000"
echo "2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É"
echo "3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –∞–≥–µ–Ω—Ç—É (–Ω–∞–∂–º–∏—Ç–µ Connect)"
echo "4. –ê–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç —Å—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ—Ä–≤—å—é"
echo "5. –ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–≤—å—é –Ω–µ –ø—Ä–æ–≤–æ–¥–∏–ª–æ—Å—å ‚Üí –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –µ–≥–æ –ø—Ä–æ–≤–µ—Å—Ç–∏"
echo "6. –ï—Å–ª–∏ –ø—Ä–æ–≤–æ–¥–∏–ª–æ—Å—å ‚Üí —Å–æ–æ–±—â–∏—Ç –æ–± —ç—Ç–æ–º"
echo ""
echo "üé® –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∫–Ω–æ–ø–∫–∏ –∏–Ω—Ç–µ—Ä–≤—å—é:"
echo "   üé§ –ò–Ω—Ç–µ—Ä–≤—å—é (–∑–µ–ª–µ–Ω—ã–π) - –Ω–µ –ø—Ä–æ–≤–æ–¥–∏–ª–æ—Å—å"
echo "   ‚úÖ –ò–Ω—Ç–µ—Ä–≤—å—é ‚úì (—Å–∏–Ω–∏–π) - –∑–∞–≤–µ—Ä—à–µ–Ω–æ"
echo "   ‚ùå –ò–Ω—Ç–µ—Ä–≤—å—é ? (–∫—Ä–∞—Å–Ω—ã–π) - –æ—à–∏–±–∫–∞"
echo ""
echo "üí° –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É '–ò–Ω—Ç–µ—Ä–≤—å—é' –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞"
